<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ian Meneghel Danilevicz">
<meta name="author" content="Sam Vidil">
<meta name="author" content="Séverine Sabia">
<meta name="dcterms.date" content="2025-10-07">
<meta name="keywords" content="Machine learning, Survival analysis, Variable selection, Cross-validation, Bootstrap">
<meta name="description" content="This document provides a template based on the Quarto system for contributions to Computo. The GitHub repository provides a specific Quarto extension useful for authors (and editors).">

<title>Challenging estimation of tuning parameters in sPLSDR model to predict the incidence of rare diseases</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="computo-quarto-extension_files/libs/clipboard/clipboard.min.js"></script>
<script src="computo-quarto-extension_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="computo-quarto-extension_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="computo-quarto-extension_files/libs/quarto-html/popper.min.js"></script>
<script src="computo-quarto-extension_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="computo-quarto-extension_files/libs/quarto-html/anchor.min.js"></script>
<link href="computo-quarto-extension_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="computo-quarto-extension_files/libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="computo-quarto-extension_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="computo-quarto-extension_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="computo-quarto-extension_files/libs/bootstrap/bootstrap-ea5a2bdf45510298ba2c6da812c063fa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="computo-quarto-extension_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="computo-quarto-extension_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #FFFFFF;
      }

      .quarto-title-block .quarto-title-banner {
        color: #FFFFFF;
background: #034E79;
      }
</style>
<meta name="quarto:status" content="draft">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="Challenging estimation of tuning parameters in sPLSDR model to predict the incidence of rare diseases">
<meta name="citation_abstract" content="We investigate some practical points of the sparse partial least squares deviance residuals (sPLSDR) model, 
a machine learning (ML) method with important application potential and a powerful alternative for Cox regression 
analysis when dimension reduction and variable selection are required. It can be used in a broad range of 
contexts, among which the health domain. This method requires to tune two hyper-parameters: eta (sparsity level) 
and D (number of components). Usually, the literature recommends cross-validation (CV) with a number of folds 
that depends on the sample size to estimate the hyperparameters. However, in case of dichotomous outcome for 
which the ratio of cases and non-cases is small this approach appears to be unstable. This is the case in rare 
disease such as incidence of major neurocognitive disorder (NCD). In that case, even large samples may perform 
as poorly as small samples. We specifically test this scenario of large samples with rare events using Monte 
Carlo simulations with different performance criteria (C-index and AIC). We observed that five folds are 
more conservative (biased) than one fold, and it presents more variability (less precise) in case of rare 
event outcomes. Previous authors suggested that Bootstrap or leave-one-out (LOO) could be a wise alternative. 
We checked Bootstrap with one fold in our real analysis application using the Whitehall II accelerometer 
sub-study (N total = 3,969,  cases = 291 (7.3%)) as a training set and the UK Biobank as a validation set 
(N total = 54,833,  cases = 750 (1.4%)), both considerably large sample size studies, with incidence of 
major neurocognitive disorders as an example of rare outcomes. This application shows that CV is sensitive 
to the number of folds and the initial seed. The counterpart Bootstrap was more robust and displayed two 
components with eta equal to 0.75 as a consistent optimum choice for the tuning parameters. However, this 
approach requires external validation, which is not always feasible. Further studies can better map the 
ideal number of folds for CV depending on the sample size and the ratio of cases/non-cases. As dichotomous 
outcomes and survival time are classical statistical subjects, the ML literature provide clear and precise 
recommendations for several available dawn methods.
">
<meta name="citation_keywords" content="Machine learning,Survival analysis,Variable selection,Cross-validation,Bootstrap">
<meta name="citation_author" content="Ian Meneghel Danilevicz">
<meta name="citation_author" content="Sam Vidil">
<meta name="citation_author" content="Séverine Sabia">
<meta name="citation_publication_date" content="2025-10-07">
<meta name="citation_cover_date" content="2025-10-07">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-10-07">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Reticulate: Interface to python;,citation_author=Kevin Ushey;,citation_author=JJ Allaire;,citation_author=Yuan Tang;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://github.com/rstudio/reticulate;">
<meta name="citation_reference" content="citation_title=Computo: Reproducible computational/algorithmic contributions in statistics and machine learning;,citation_author=Computo Team;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;">
<meta name="citation_reference" content="citation_title=R: A language and environment for statistical computing;,citation_author=R Core Team;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://www.R-project.org/;">
<meta name="citation_reference" content="citation_title=Simulating survival data using the simsurv r package;,citation_author=S. L. Brilleman;,citation_author=R. Wolfe;,citation_author=M. Moreno-Betancur;,citation_author=Michael J. Crowther;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://www.jstatsoft.org/index.php/jss/article/view/v097i03;,citation_issue=3;,citation_doi=10.18637/jss.v097.i03;,citation_volume=97;,citation_journal_title=J Stat Soft;">
<meta name="citation_reference" content="citation_title=Deviance residuals-based sparse PLS and sparse kernel PLS regression for censored data;,citation_author=P. Bastien;,citation_author=F. Bertrand;,citation_author=N. Meyer;,citation_author=Myriam Maumy-Bertrand;,citation_publication_date=2014-10;,citation_cover_date=2014-10;,citation_year=2014;,citation_issue=3;,citation_doi=10.1093/bioinformatics/btu660;,citation_issn=1367-4803;,citation_volume=31;,citation_journal_title=Bioinformatics;">
<meta name="citation_reference" content="citation_title=Deviance residuals based PLS regression for censored data in high dimensional setting;,citation_author=P. Bastien;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=1;,citation_doi=10.1016/j.chemolab.2007.09.009;,citation_volume=91;,citation_journal_title=Chemometr Intell Lab Syst;">
<meta name="citation_reference" content="citation_title=Multivariate Data Integration Using R;,citation_author=K.-A. Lê Cao;,citation_author=Z. M. Welham;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=10.1201/9781003026860;">
<meta name="citation_reference" content="citation_title=Modelling survival data in medical research;,citation_author=D. Collett;,citation_publication_date=1994;,citation_cover_date=1994;,citation_year=1994;,citation_doi=10.1201/b18041;">
<meta name="citation_reference" content="citation_title=Sparse PLS discriminant analysis;,citation_author=K.-A. Lê Cao;,citation_author=S. Boitard;,citation_author=P. Besse;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=253;,citation_doi=10.1186/1471-2105-12-253;,citation_volume=12;,citation_journal_title=BMC Bioinformatics;">
<meta name="citation_reference" content="citation_title=Submodel Selection and Evaluation in Regression;,citation_author=L. Breiman;,citation_author=P. Spector;,citation_publication_date=1992;,citation_cover_date=1992;,citation_year=1992;,citation_issue=3;,citation_doi=10.2307/1403680;,citation_volume=60;,citation_journal_title=Int Stat Rev;">
<meta name="citation_reference" content="citation_title=A study of cross-validation and bootstrap for accuracy estimation and model selection;,citation_author=R. Kohavi;,citation_publication_date=1995;,citation_cover_date=1995;,citation_year=1995;,citation_doi=10.5555/1643031.1643047;,citation_conference_title=14 int. Joint conf. AI;">
<meta name="citation_reference" content="citation_title=Identification of physical activity and sedentary behaviour dimensions that predict mortality risk in older adults;,citation_author=M. Chen;,citation_author=B. Landré;,citation_author=P. Marques-Vidal;,citation_author=Vincent T Hees;,citation_author=April C E Gennip;,citation_author=Mikaela Bloomberg;,citation_author=Manasa S Yerramalla;,citation_author=Mohamed Amine Benadjaoud;,citation_author=Séverine Sabia;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_doi=10.1016/j.eclinm.2022.101773;,citation_volume=55;,citation_journal_title=EClinicalMedicine;">
<meta name="citation_reference" content="citation_title=Reporting adherence, validity and physical activity measures of wearable activity trackers in medical research: A systematic review;,citation_author=A. Chan;,citation_author=D. Chan;,citation_author=H. Lee;,citation_author=C. C. Ng;,citation_author=Yeo A. H. L.;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_doi=10.1016/j.ijmedinf.2022.104696;,citation_volume=160;,citation_journal_title=Int J Med Inform.;">
<meta name="citation_reference" content="citation_title=Accelerometer-derived physical activity in those with cardio-metabolic disease compared to healthy adults;,citation_author=S. Cassidy;,citation_author=H. Fuller;,citation_author=J. Chau;,citation_author=Michael Catt;,citation_author=Adrian Bauman;,citation_author=Michael I Trenell;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=9;,citation_doi=10.1007/s00592-018-1161-8;,citation_volume=55;,citation_journal_title=Acta Diabetol.;">
<meta name="citation_reference" content="citation_title=Accelerometer-measured physical activity and sitting with incident mild cognitive impairment or probable dementia among older women;,citation_author=S. Nguyen;,citation_author=A. Z. LaCroix;,citation_author=K. M. Hayden;,citation_author=C. Di;,citation_author=P. Palta;,citation_author=M. L. Stefanick;,citation_author=J. E. Manson;,citation_author=S. R. Rapp;,citation_author=M. J. LaMonte;,citation_author=J. Bellettiere;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=7;,citation_doi=10.1002/alz.12908;,citation_volume=19;,citation_journal_title=Alzheimer Dement.;">
<meta name="citation_reference" content="citation_title=Building predictive models in r using the caret package;,citation_author=Kuhn;,citation_author=Max;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_fulltext_html_url=https://www.jstatsoft.org/index.php/jss/article/view/v028i05;,citation_issue=5;,citation_doi=10.18637/jss.v028.i05;,citation_volume=28;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=Coxmos: Cox MultiBlock survival;,citation_author=Pedro Salguero García;,citation_publication_date=2025;,citation_cover_date=2025;,citation_year=2025;,citation_fulltext_html_url=https://github.com/BiostatOmics/Coxmos;">
<meta name="citation_reference" content="citation_title=GGIR: a research community–driven open source R package for generating physical activity and sleep outcomes from multi-day raw accelerometer data;,citation_author=J. H. Migueles;,citation_author=A. V. Rowlands;,citation_author=F. Huber;,citation_author=Séverine Sabia undefined;,citation_author=Vincent T. Hees;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=3;,citation_doi=10.1123/jmpb.2018-0063;,citation_volume=2;,citation_journal_title=J. Meas. Phys. Behav;">
<meta name="citation_reference" content="citation_title=Measures of fragmentation of rest activity patterns: mathematical properties and interpretability based on accelerometer real life data;,citation_author=I. M. Danilevicz;,citation_author=V. T. Hees;,citation_author=Frank C. T. Heide;,citation_author=Louis Jacob;,citation_author=Benjamin Landré;,citation_author=Mohamed Amine Benadjaoud;,citation_author=Séverine Sabia;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=1, 132;,citation_doi=10.1186/s12874-024-02255-w;,citation_volume=24;,citation_journal_title=BMC Med. Res. Methodol;">
<meta name="citation_reference" content="citation_title=Reliable measures of rest-activity rhythm fragmentation: how many days are needed?;,citation_author=I. M. Danilevicz;,citation_author=Sam Vidil;,citation_author=Benjamin Landré;,citation_author=Aline Dugravot;,citation_author=Vincent Theodor Hees;,citation_author=Séverine Sabia;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=29;,citation_doi=10.1186/s11556-024-00364-5;,citation_volume=21;,citation_journal_title=Eur Rev Aging Phys Act;">
<meta name="citation_reference" content="citation_title= Cohort profile: the Whitehall II study;,citation_author=M. Marmot;,citation_author=E. Brunner;,citation_publication_date=2005;,citation_cover_date=2005;,citation_year=2005;,citation_issue=2;,citation_doi=10.1093/ije/dyh372;,citation_volume=34;,citation_journal_title=Int J Epidemiol.;">
<meta name="citation_reference" content="citation_title=The UK Biobank imaging enhancement of 100,000 participants;,citation_author=T. J. Littlejohns;,citation_author=J. Holliday;,citation_author=L. M. Gibson;,citation_author=S. Garratt;,citation_author=N. Oesingmann;,citation_author=F. Alfaro-Almagro;,citation_author=undefined et al.;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=1;,citation_doi=10.1038/s41467-020-15948-9;,citation_volume=11;,citation_journal_title=Nat Commun.;">
<meta name="citation_reference" content="citation_title=Survival prediction of diffuse large-B-cell lymphoma based on both clinical and gene expression information;,citation_author=L. Li;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=4;,citation_doi=10.1093/bioinformatics/bti824;,citation_volume=22;,citation_journal_title=Bioinformatics;">
<meta name="citation_reference" content="citation_title=PLS generalized linear regression. Application to the analysis of life time data.;,citation_author=P. Bastien;,citation_author=M. Tenenhaus;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_conference_title=Proceedings of the PLS’01 international symposium anacapri;">
<meta name="citation_reference" content="citation_title=Sparse partial least squares regression for simultaneous dimension reduction and variable selection;,citation_author=H. Chun;,citation_author=S. Keles;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_doi=10.1111/j.1467-9868.2009.00723.x;,citation_volume=72;,citation_journal_title=J. R. Stat. Soc. B;">
<meta name="citation_reference" content="citation_title=A modified principal component technique based on the LASSO;,citation_author=I Jolliffe;,citation_author=N. T. Trendafilov;,citation_author=M. Uddin;,citation_publication_date=2003;,citation_cover_date=2003;,citation_year=2003;,citation_doi=10.1198/1061860032148;,citation_volume=12;,citation_journal_title=J. Comput. Graph. Stat.;">
<meta name="citation_reference" content="citation_title=Large Scale Population Assessment of Physical Activity Using Wrist Worn Accelerometers;,citation_author=A. Doherty;,citation_author=D. Jackson;,citation_author=Nils Hammerla;,citation_author=Thomas Plötz;,citation_author=Patrick Olivier;,citation_author=Malcolm H. Granat;,citation_author=Tom White;,citation_author=Vincent T. Hees;,citation_author=Michael I. Trenell;,citation_author=Christoper G. Owen;,citation_author=Stephen J. Preece;,citation_author=Rob Gillions;,citation_author=Simon Sheard;,citation_author=Tim Peakman;,citation_author=Soren Brage;,citation_author=Nicholas J. Wareham;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_doi=10.1371/journal.pone.0169649;,citation_volume=12;,citation_journal_title=PloS one;">
<meta name="citation_reference" content="citation_title=Comparing two correlated C indices with right-censored survival outcome;,citation_author=L. Kang;,citation_author=W. Chen;,citation_author=Nicholas A Petrick;,citation_author=Brandon D Gallas;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=4;,citation_doi=10.1002/sim.6370;,citation_volume=34;,citation_journal_title=Stat Med.;">
<meta name="citation_reference" content="citation_title=Healthy lifestyles for dementia prevention;,citation_author=S. Sabia;,citation_author=A. Singh-Manoux;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=117;,citation_doi=10.1136/bmj.p117;,citation_volume=380;,citation_journal_title=BMJ Clinical research;">
</head>

<body class="quarto-light"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><a href="https://computo-journal.org">
        <img src="logo_notext_white.png" height="60px">
      </a> &nbsp; Challenging estimation of tuning parameters in sPLSDR model to predict the incidence of rare diseases</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> source</button></div></div>
            <p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/80x15.png" alt="Creative Commons BY License"></a>
ISSN 2824-7795</p>
            <div>
        <div class="description">
          <p>This document provides a template based on the Quarto system for contributions to <em>Computo</em>. The GitHub repository provides a specific Quarto extension useful for authors (and editors).</p>
        </div>
      </div>
                </div>
  </div>
    
    <div class="quarto-title-meta-author">
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-heading">Affiliations</div>
          
          <div class="quarto-title-meta-contents">
        <a href="https://github.com/iandanilevicz/">Ian Meneghel Danilevicz</a> <a href="https://orcid.org/0000-0003-4541-0524" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Université Paris Cité, Inserm, Center for Research in Epidemiology and Statistics (CRESS)
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Sam Vidil <a href="https://orcid.org/0009-0007-6414-3966" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Université Paris Cité, Inserm, Center for Research in Epidemiology and Statistics (CRESS)
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Séverine Sabia <a href="https://orcid.org/0000-0003-3109-9720" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Université Paris Cité, Inserm, Center for Research in Epidemiology and Statistics (CRESS)
                </p>
              <p class="affiliation">
                  University College London
                </p>
            </div>
        </div>
                    
  <div class="quarto-title-meta">
                                
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 7, 2025</p>
      </div>
    </div>
                                    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">October 7, 2025</p>
      </div>
    </div>
      
                  
      <div>
      <div class="quarto-title-meta-heading">Keywords</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Machine learning, Survival analysis, Variable selection, Cross-validation, Bootstrap</p>
      </div>
    </div>
    
    <div>
      <div class="quarto-title-meta-heading">Status</div>
      <div class="quarto-title-meta-contents">
              <p class="date">draft</p>
                  </div>
    </div>

  </div>
                                                
  <div>
    <div class="abstract">
    <div class="abstract-title">Abstract</div>
      <p>We investigate some practical points of the sparse partial least squares deviance residuals (sPLSDR) model, a machine learning (ML) method with important application potential and a powerful alternative for Cox regression analysis when dimension reduction and variable selection are required. It can be used in a broad range of contexts, among which the health domain. This method requires to tune two hyper-parameters: eta (sparsity level) and D (number of components). Usually, the literature recommends cross-validation (CV) with a number of folds that depends on the sample size to estimate the hyperparameters. However, in case of dichotomous outcome for which the ratio of cases and non-cases is small this approach appears to be unstable. This is the case in rare disease such as incidence of major neurocognitive disorder (NCD). In that case, even large samples may perform as poorly as small samples. We specifically test this scenario of large samples with rare events using Monte Carlo simulations with different performance criteria (C-index and AIC). We observed that five folds are more conservative (biased) than one fold, and it presents more variability (less precise) in case of rare event outcomes. Previous authors suggested that Bootstrap or leave-one-out (LOO) could be a wise alternative. We checked Bootstrap with one fold in our real analysis application using the Whitehall II accelerometer sub-study (N total = 3,969, cases = 291 (7.3%)) as a training set and the UK Biobank as a validation set (N total = 54,833, cases = 750 (1.4%)), both considerably large sample size studies, with incidence of major neurocognitive disorders as an example of rare outcomes. This application shows that CV is sensitive to the number of folds and the initial seed. The counterpart Bootstrap was more robust and displayed two components with eta equal to 0.75 as a consistent optimum choice for the tuning parameters. However, this approach requires external validation, which is not always feasible. Further studies can better map the ideal number of folds for CV depending on the sample size and the ratio of cases/non-cases. As dichotomous outcomes and survival time are classical statistical subjects, the ML literature provide clear and precise recommendations for several available dawn methods.</p>
    </div>
  </div>

  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method"><span class="header-section-number">2</span> Method</a>
  <ul class="collapse">
  <li><a href="#the-spls-technique" id="toc-the-spls-technique" class="nav-link" data-scroll-target="#the-spls-technique"><span class="header-section-number">2.1</span> The sPLS technique</a></li>
  <li><a href="#the-cox-proportional-hazards-model" id="toc-the-cox-proportional-hazards-model" class="nav-link" data-scroll-target="#the-cox-proportional-hazards-model"><span class="header-section-number">2.2</span> The Cox proportional hazards model</a></li>
  <li><a href="#deviance-residuals" id="toc-deviance-residuals" class="nav-link" data-scroll-target="#deviance-residuals"><span class="header-section-number">2.3</span> Deviance residuals</a></li>
  <li><a href="#the-splsdr-model" id="toc-the-splsdr-model" class="nav-link" data-scroll-target="#the-splsdr-model"><span class="header-section-number">2.4</span> The sPLSDR model</a></li>
  </ul></li>
  <li><a href="#monte-carlo-study" id="toc-monte-carlo-study" class="nav-link" data-scroll-target="#monte-carlo-study"><span class="header-section-number">3</span> Monte Carlo study</a>
  <ul class="collapse">
  <li><a href="#simulation-plan" id="toc-simulation-plan" class="nav-link" data-scroll-target="#simulation-plan"><span class="header-section-number">3.1</span> Simulation plan</a></li>
  <li><a href="#simulation-implementation" id="toc-simulation-implementation" class="nav-link" data-scroll-target="#simulation-implementation"><span class="header-section-number">3.2</span> Simulation implementation</a></li>
  <li><a href="#simulation-results" id="toc-simulation-results" class="nav-link" data-scroll-target="#simulation-results"><span class="header-section-number">3.3</span> Simulation results</a></li>
  </ul></li>
  <li><a href="#real-application" id="toc-real-application" class="nav-link" data-scroll-target="#real-application"><span class="header-section-number">4</span> Real application</a>
  <ul class="collapse">
  <li><a href="#real-datasets" id="toc-real-datasets" class="nav-link" data-scroll-target="#real-datasets"><span class="header-section-number">4.1</span> Real datasets</a></li>
  <li><a href="#real-data-results" id="toc-real-data-results" class="nav-link" data-scroll-target="#real-data-results"><span class="header-section-number">4.2</span> Real data results</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">5</span> Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#declarations" id="toc-declarations" class="nav-link" data-scroll-target="#declarations"><span class="header-section-number">7</span> Declarations</a>
  <ul class="collapse">
  <li><a href="#acknowledges" id="toc-acknowledges" class="nav-link" data-scroll-target="#acknowledges"><span class="header-section-number">7.1</span> Acknowledges:</a></li>
  <li><a href="#funding" id="toc-funding" class="nav-link" data-scroll-target="#funding"><span class="header-section-number">7.2</span> Funding:</a></li>
  <li><a href="#data-availability" id="toc-data-availability" class="nav-link" data-scroll-target="#data-availability"><span class="header-section-number">7.3</span> Data availability</a></li>
  <li><a href="#ethics-approval-and-consent-to-participate" id="toc-ethics-approval-and-consent-to-participate" class="nav-link" data-scroll-target="#ethics-approval-and-consent-to-participate"><span class="header-section-number">7.4</span> Ethics approval and consent to participate:</a></li>
  <li><a href="#authors-contributions" id="toc-authors-contributions" class="nav-link" data-scroll-target="#authors-contributions"><span class="header-section-number">7.5</span> Authors’ contributions</a></li>
  <li><a href="#competing-interests" id="toc-competing-interests" class="nav-link" data-scroll-target="#competing-interests"><span class="header-section-number">7.6</span> Competing interests:</a></li>
  </ul></li>
  <li><a href="#finalize-your-submission" id="toc-finalize-your-submission" class="nav-link" data-scroll-target="#finalize-your-submission"><span class="header-section-number">8</span> Finalize your submission</a>
  <ul class="collapse">
  <li><a href="#handle-r-dependencies-with-renv" id="toc-handle-r-dependencies-with-renv" class="nav-link" data-scroll-target="#handle-r-dependencies-with-renv"><span class="header-section-number">8.1</span> Handle <code>R</code> dependencies with <code>renv</code></a></li>
  </ul></li>
  
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Accelerometer devices objectively measure the wrist acceleration of human participants <span class="citation" data-cites="Migueles2019">Migueles et al. (<a href="#ref-Migueles2019" role="doc-biblioref">2019</a>)</span>. The derived features calculated from the accelerometer three axial time series aggregated per minute for each participant during a certain period of time can be used to estimate rest-activity rhythm, daytime activity, sleep, and chronotype. These features can be used to predict several health outcomes such as mortality <span class="citation" data-cites="Chen2022">Chen et al. (<a href="#ref-Chen2022" role="doc-biblioref">2022</a>)</span>, cardio-metabolic diseases <span class="citation" data-cites="Cassidy2018">Cassidy et al. (<a href="#ref-Cassidy2018" role="doc-biblioref">2018</a>)</span>, and neurodegenerative diseases <span class="citation" data-cites="Nguyen2023">Nguyen et al. (<a href="#ref-Nguyen2023" role="doc-biblioref">2023</a>)</span>. This represents a vast potential for medical research <span class="citation" data-cites="Chan2022">Chan et al. (<a href="#ref-Chan2022" role="doc-biblioref">2022</a>)</span> as these devices provide a more objective and detailed information than commonly used self-reported data.</p>
<p>In survival analysis, we model the duration from a time origin until an event of interest occurs, considering a set of predictors. In case of several candidate predictors, some selection and/or combination of predictors are often operated to allow for a parsimonious model, using machine learning (ML) methods such as the sparse partial least squares deviance residuals (sPLSDR) model <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>.</p>
<p>ML methods often require tuning parameters to be fitted. These parameters are usually pre-estimated using cross-validation (CV) techniques. The general recommendation consists of doing 3 to 10 folds (depending on the sample size) <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021</a>)</span>, within a CV with all combinations of hyper-parameters. The general rule is <span class="math inline">n/k&gt;5</span>, where <span class="math inline">n</span> is the sample size and <span class="math inline">k</span> the number of folds <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021</a>)</span>(page 82). The sPLSDR requires two hyper-parameters: First <span class="math inline">\eta \in [0,1)</span>, where 0 means a full dense model with all features, and values close to 1 a highly sparse model with only few features retained; second <span class="math inline">D</span> components (each component is a combination of features as in PLS regression). One approach consists of determining a large maximum number of components <span class="math inline">D</span> and a large grid for <span class="math inline">\eta</span>, later trying a finer grid for <span class="math inline">\eta</span> only on the best options of <span class="math inline">D</span> <span class="citation" data-cites="Chen2022">Chen et al. (<a href="#ref-Chen2022" role="doc-biblioref">2022</a>)</span>. To evaluate the hotspots which are considering the best hyperparameter options must be based on a criterion, eg, integrated AUC survival ROC (iAUC) <span class="citation" data-cites="Li2006">Li (<a href="#ref-Li2006" role="doc-biblioref">2006</a>)</span>. Even if this approach is commonly used, there are situations when it lacks enough stability.</p>
<p>It happens that when the outcome of interest is rare, for example major neurocognitive disorder (NCD), the process of optimisation is unstable for different fold values, and even for the same fold value, it may vary according the initial seed, indicating a lack of reliability. This instability could be due to small sample size where 5 folds for CV are recommended, but we hypothesise that the low proportion of cases by non-cases could be problematic even for large and medium sample size studies.</p>
<p>This paper will discuss ways to overcome the challenge of tuning parameter estimation in cases of rare events. Our application is based on the identification of accelerometer data predicting major NCD, such as Alzheimer’s disease, using the Whitehall II (<span class="math inline">n=3969</span>) as a training set and the UK Biobank (UKB) as a validation set. Our proposition to get stable results for the tuning parameters is to keep all the data from the training set and bootstrap it, and then to test the validity of the model using in an external dataset (UKB). The optimization process for Whitehall II is unstable for different fold values, and even for the same fold value (with different initial seed), which indicates a lack of reliability. The instability is not due to a small sample size, as Whitehall II is a relatively large cohort. However, the outcome presents a small proportion of incident events (1.4%, the target disease is the major NCD, which includes Alzheimer’s disease). The problem was not fixed when considering the rules for small sample size (5 folds) which is far from the bottom level <span class="math inline">n/k&gt;5</span> suggest by <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021</a>)</span>(page 82).</p>
<p>A small simulation study was conducted to test the hypotheses of low stability in case of small ratio between cases and non-cases. We artificially created data sets with <span class="math inline">n=5000</span> where the maximum observation time is 10 years of a disease for which incidence over time is small (resulting in few cases occurring during the observation period). In these simulations, we divided the data into five folds or keep the whole pool together, and we estimated the models using traditional performance criteria, such as the C-index and the Akaike information criterion (AIC).</p>
</section>
<section id="method" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Method</h1>
<section id="the-spls-technique" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="the-spls-technique"><span class="header-section-number">2.1</span> The sPLS technique</h2>
<p>The sparse partial least squares regression (sPLS) was proposed by <span class="citation" data-cites="Chun2010">Chun and Keles (<a href="#ref-Chun2010" role="doc-biblioref">2010</a>)</span> to promote variable selection during PLS dimension reduction. The sPLS can select variables for the first direction vector and additional variables in the construction of the subsequent direction vectors <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>.</p>
<p>A direct extension of PLS regression to sPLS regression could be provided by imposing <span class="math inline">L_1</span> constraint on PLS direction on <span class="math inline">n</span>-vector <span class="math inline">w</span> as <span id="eq-spls"><span class="math display">
\max_{w} w^T M w \text{ subject to } w^Tw = ||w||_2 = 1, ||w||_1 \leq c,
\tag{1}</span></span> where <span class="math inline">||w||_2 = w^Tw</span>, <span class="math inline">||w||_1=\sum_{i=1}^{n} |w_i|</span>, <span class="math inline">|u|</span> is the absolute of <span class="math inline">u</span>, <span class="math inline">M=X^T Y Y^T X</span>, <span class="math inline">Y</span> and <span class="math inline">X</span> are matrices with the same number of rows, <span class="math inline">c &gt; 0</span> is the <span class="math inline">L_1</span> constraint. If <span class="math inline">Y=X</span>, then we have the special case sparse principal component analysis (sPCA) <span class="citation" data-cites="Jolliffe2003">Jolliffe, Trendafilov, and Uddin (<a href="#ref-Jolliffe2003" role="doc-biblioref">2003</a>)</span>.</p>
</section>
<section id="the-cox-proportional-hazards-model" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="the-cox-proportional-hazards-model"><span class="header-section-number">2.2</span> The Cox proportional hazards model</h2>
<p>The model assumes the following hazard function for the occurrence of an event at time <span class="math inline">t</span> in the presence of censoring as follows <span class="math inline">h(t) = h_0(t) \exp( \beta^T X),</span> where <span class="math inline">h_0(t)</span> is a baseline hazard function, <span class="math inline">\beta</span> is a vector of regression coefficients and <span class="math inline">X = (X_1,\dots,X_p)</span> is a <span class="math inline">n \times p</span> matrix of features with <span class="math inline">x_i = (x_{i1}, \dots, x_{ip})</span> a row-vector for the i-th individual. The event could be any disease of interest. Based on the available data, Cox’s partial likelihood can be written as <span class="math display">
    L(\beta) = \prod_{k \in \Omega} \frac{\exp( \beta^T x_k)}{\sum_{j \in \zeta_k} \exp( \beta^T x_j)},
</span> where <span class="math inline">\Omega</span> is the set of indices of the events and <span class="math inline">\zeta_k</span> denotes the set of indices of the individuals at risk at time <span class="math inline">t_k</span>. The goal is to find the coefficients which maximize the log partial likelihood function <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>.</p>
</section>
<section id="deviance-residuals" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="deviance-residuals"><span class="header-section-number">2.3</span> Deviance residuals</h2>
<p>Here, we consider a Cox model with no time-dependent explanatory variables and, at most, one event per patient. Regardless, the Martingale residuals for the i-th subject with observation time <span class="math inline">t_i</span> and event status <span class="math inline">\delta_i</span>, where <span class="math inline">\delta_i=0</span> if <span class="math inline">t_i</span> is a censored time, and <span class="math inline">\delta_i=1</span> otherwise is as <span class="math display">
m_i = \delta_i - \hat{\Delta}_0(t_i) \exp (\hat{\beta}^T x_i),
</span> where <span class="math inline">\hat{\Delta}_0(t_i)</span> is the estimated cumulative hazard function at time <span class="math inline">t_i</span> <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>. However, the Martingale residuals used to be highly skewed <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>. Although, the deviance residuals <span class="math inline">r_i</span> are a normalized transform of the martingale residuals. For the Cox model, the deviance residuals <span class="citation" data-cites="Collett1994">Collett (<a href="#ref-Collett1994" role="doc-biblioref">1994</a>)</span> amount to a form as <span id="eq-residuals"><span class="math display">  
r_i = \mathrm{sign}  (m_i) [2\{ - r_i - \delta_i \log (\delta_i - m_i)\}]^{0.5},
\tag{2}</span></span></p>
<p>where <span class="math inline">\mathrm{sign}(u)</span> is the sign of <span class="math inline">u \in \mathbb{R}</span>.</p>
</section>
<section id="the-splsdr-model" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="the-splsdr-model"><span class="header-section-number">2.4</span> The sPLSDR model</h2>
<p>The sparse partial least squares deviance residual (sPLSDR) model was proposed by <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span> as an upgrade concerning sPLS proposed by <span class="citation" data-cites="Chun2010">Chun and Keles (<a href="#ref-Chun2010" role="doc-biblioref">2010</a>)</span> and partial least squares Cox (PLS-Cox) <span class="citation" data-cites="Bastien2001">Bastien and Tenenhaus (<a href="#ref-Bastien2001" role="doc-biblioref">2001</a>)</span>, <span class="citation" data-cites="Bastien2008">Bastien (<a href="#ref-Bastien2008" role="doc-biblioref">2008</a>)</span>. The general idea is to apply the sPLS technique presented in <a href="#eq-spls" class="quarto-xref">Equation&nbsp;1</a> on the deviance residual from <a href="#eq-residuals" class="quarto-xref">Equation&nbsp;2</a>.</p>
<p>The algorithm was described in <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span> as folllows</p>
<ol type="1">
<li>Cox model without covariates to derive the null deviance residuals <span class="math inline">r = (r_1, \dots, r_n)^T</span> from <a href="#eq-residuals" class="quarto-xref">Equation&nbsp;2</a>.</li>
<li>Computation of the sPLS components by using the sPLS regression from <a href="#eq-spls" class="quarto-xref">Equation&nbsp;1</a> with the null deviance residuals as outcome.</li>
<li>Set <span class="math inline">\hat{\beta}^{PLS}=0</span>, <span class="math inline">d=1</span>, <span class="math inline">Y=r</span>.</li>
<li>While <span class="math inline">d \leq D</span>: 4.1. <span class="math inline">w = (|z|-c/2)+ \mathrm{sign}(z)</span>, where <span class="math inline">z=X^TY/|| X^TY||_2</span>. 4.2. Update <span class="math inline">\Omega</span> as <span class="math inline">\{d : \hat{w}_d \neq 0\} \cup \{d : \hat{\beta}^{PLS}_d \neq 0\}</span>. 4.3. Fit sPLS with <span class="math inline">X</span> by using the <span class="math inline">d</span> number of latent components. 4.4. Update <span class="math inline">\hat{\beta}^{PLS}</span> by using the new sPLS estimates of the direction vectors and update <span class="math inline">Y</span> and <span class="math inline">d</span> through <span class="math inline">Y \leftarrow Y-X\hat{\beta}^{PLS}</span> and <span class="math inline">d \leftarrow d+1</span>.</li>
<li>Cox model on the <span class="math inline">D</span> retained sPLSDR components.</li>
</ol>
</section>
</section>
<section id="monte-carlo-study" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Monte Carlo study</h1>
<section id="simulation-plan" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="simulation-plan"><span class="header-section-number">3.1</span> Simulation plan</h2>
<p>We used an exponential survival model, where the hazard function is <span id="eq-sim"><span class="math display">
h_i(t) = \lambda \exp( X_i \beta ),
\tag{3}</span></span> and the cumulative hazard is <span class="math display">H_i(t) = \lambda t \exp( X_i \beta ),</span> such as implemented on the <strong>simsurv</strong> R Package by <span class="citation" data-cites="Brilleman2021">Brilleman et al. (<a href="#ref-Brilleman2021" role="doc-biblioref">2021</a>)</span>. We create artificial data with <span class="math inline">n=5000</span> number of individuals, <span class="math inline">\lambda=0.05, 0.005</span> rate parameter, <span class="math inline">\beta^T = (\beta^T_1, \beta^T_2, \beta^T_3)</span> is the coefficient parameters, composed by <span class="math inline">\beta^T_1 = (0.15, 0.1, 0.05)</span>, <span class="math inline">\beta^T_2 = (-0.15, -0.1, -0.05)</span> and<br>
<span class="math inline">\beta^T_3=(0,0,0,0,0,0)</span>; the covariate matrix is <span class="math inline">X_{i,(1:3)} \sim N(\mu_1, R)</span> a multivariate normal with <span class="math inline">\mu_1=(0.15, 0.1, 0.05)^T</span> and <span class="math inline">R</span> a matrix with variance on the diagonal of ones and covariance on the off-diagonals of 0.5; <span class="math inline">X_{i,(4:6)} \sim N(\mu_2, R)</span> a multivariate normal with <span class="math inline">\mu_2=(-0.15, -0.1, -0.05)^T</span> and same covariance; <span class="math inline">X_{i,(7:12)} \sim N(\mu_3, I)</span> a multivariate normal with <span class="math inline">\mu_3=(0,0,0,0,0,0)^T</span> and <span class="math inline">I</span> an identity matrix. The maximum observed time is <span class="math inline">m=10</span>.</p>
<p>So this simple model may be well estimated by a sPLSDR model with two dimensions. We proceed with a Monte Carlo simulation, replicating <span class="math inline">M=1000</span> times each <span class="math inline">\lambda</span> and estimating the model changing <span class="math inline">\eta=0, 0.1, 0.2, \dots, 0.9</span>, using <span class="math inline">k=1,5</span> folds. We save the C-index and the AIC of each iteration of the Monte Carlo. We set all models with two dimensions (<span class="math inline">D=2</span>). Finally, we count how many times each value of <span class="math inline">\eta</span> was considered the best in the row; this results in a frequency per value of <span class="math inline">\eta</span>.</p>
</section>
<section id="simulation-implementation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="simulation-implementation"><span class="header-section-number">3.2</span> Simulation implementation</h2>
<p>Before the results, we implemented some functions available in the R folder. Also, some packages are necessary, such as <strong>plsRcox</strong> (the original package to estimate sPLSDR <span class="citation" data-cites="Bastien2014">Bastien et al. (<a href="#ref-Bastien2014" role="doc-biblioref">2014</a>)</span>), <strong>Coxmos</strong> (another package to estimate sPLSDR but with a convenient way to extract the <span class="math inline">W^*</span> matrix of weights, this matrix is similar to a loading matrix in PCA <span class="citation" data-cites="Coxmos">Salguero García (<a href="#ref-Coxmos" role="doc-biblioref">2025</a>)</span>), <strong>caret</strong> (to split the dataset in folds <span class="citation" data-cites="caret">Kuhn and Max (<a href="#ref-caret" role="doc-biblioref">2008</a>)</span>).</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set repositories</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">BioC_mirror =</span> <span class="st">"https://bioconductor.org"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: install a package only if missing</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>install_if_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg, <span class="at">bioc =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bioc) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>, <span class="at">repos =</span> <span class="st">"https://cloud.r-project.org"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      BiocManager<span class="sc">::</span><span class="fu">install</span>(pkg, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(pkg, <span class="at">repos =</span> <span class="st">"https://cloud.r-project.org"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages (only if missing)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"mixOmics"</span>, <span class="at">bioc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"survcomp"</span>, <span class="at">bioc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"plsRcox"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"Coxmos"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"simsurv"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"caret"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survcomp)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plsRcox)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Coxmos)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simsurv)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Source functions from GitHub</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/iandanilevicz/sPLSDRtuning/main/R/functions3.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we run the simulations using our loaded functions.</p>
<!--this really run -->
</section>
<section id="simulation-results" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="simulation-results"><span class="header-section-number">3.3</span> Simulation results</h2>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>eta_vals <span class="ot">&lt;-</span> sim_surv1<span class="sc">$</span>Eta[, <span class="dv">1</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sim_surv1<span class="sc">$</span>N_features)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Long format with lambda as a factor</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eta =</span> <span class="fu">rep</span>(eta_vals, <span class="at">each =</span> n_rep),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lambda_0.005 =</span> <span class="fu">as.vector</span>(sim_surv1<span class="sc">$</span>N_features),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lambda_0.05  =</span> <span class="fu">as.vector</span>(sim_surv2<span class="sc">$</span>N_features)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Lambda"</span>), <span class="at">names_to =</span> <span class="st">"Lambda"</span>, <span class="at">values_to =</span> <span class="st">"N_features"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lambda =</span> <span class="fu">recode</span>(Lambda, <span class="at">Lambda_0.005 =</span> <span class="st">"λ = 0.005"</span>, <span class="at">Lambda_0.05 =</span> <span class="st">"λ = 0.05"</span>))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: grouped boxplots</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Eta), <span class="at">y =</span> N_features, <span class="at">fill =</span> Lambda)) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(eta),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of selected features"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Selected features by eta and lambda"</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"λ = 0.005"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"λ = 0.05"</span> <span class="ot">=</span> <span class="st">"lightgreen"</span>))<span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">6</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="computo-quarto-extension_files/figure-html/unnamed-chunk-3-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The above table shows the results for the number of selected features depending on the value of <span class="math inline">\eta</span>. The number of selected features is decreasing as eta increases. Remember that we set a simulation within the coefficient parameter vector that has a length of 12, but 6 values equal to zero and six different from zero. So, a fair number of selected features must be equal or smaller than six, since there is a moderate correlation between the non-zero coefficients. Finally, the value of eta, which corresponds to a fair number of features, is <span class="math inline">\eta \in [0.8, 0.9]</span> for <span class="math inline">\lambda = 0.005</span> or <span class="math inline">\eta \in [0.9]</span> for <span class="math inline">\lambda = 0.05</span>. These regions for eta are the targets that we will search for with C-index and AIC in the following figures.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>],</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency1 =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency2 =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=2</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency3 =</span> sim_surv2<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 2</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency4 =</span> sim_surv2<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>  <span class="co"># lambda 2</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'eta' is treated as a factor for proper labeling on x-axis</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>eta <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>eta)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with ggplot2</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency1)) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency2)) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"tomato"</span>) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency3)) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency4)) <span class="sc">+</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"orchid"</span>) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>framed_label <span class="ot">&lt;-</span> <span class="cf">function</span>(text, <span class="at">angle =</span> <span class="dv">0</span>) {</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw_label</span>(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>      text,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> angle,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">0.5</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">size =</span> <span class="fl">0.8</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Label row</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>top_labels <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 1"</span>),</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 5"</span>),</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows with left labels</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.005"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  p1, p2,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.05"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  p3, p4,</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine full layout</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  top_labels,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  row1,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  row2,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title: Frequency of eta with the highest C-index by k and lambda</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_label</span>(<span class="st">"The highest C-index"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">y =</span> <span class="fl">0.98</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(combined, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.95</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="computo-quarto-extension_files/figure-html/unnamed-chunk-4-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the above figure, we see the results for the C-index. The figure shows the frequency decision taken by the highest C-index, ie at each simulation, we count the <span class="math inline">\eta</span>, which corresponds to the highest C-index. On top, <span class="math inline">\lambda=0.005</span>, which corresponds to a scenario where there are few incident cases (eg, rare disease), and on the bottom, <span class="math inline">\lambda=0.005</span> is a scenario with several incident cases (eg, common disease). On the left, the estimation is done by a <span class="math inline">k=1</span> fold, and on the right, a <span class="math inline">k=5</span> folds does it. For <span class="math inline">\lambda=0.05</span> the most frequent decision is <span class="math inline">\eta=0.7</span> when using <span class="math inline">k=5</span> which is in line with the general recommendation and with the complexity of the model, but using <span class="math inline">k=1</span> the most frequent decision is <span class="math inline">\eta=0</span> (too conservative decision). However, when <span class="math inline">\lambda=0.005</span> the decision is the reverse: using <span class="math inline">k=1</span> returns <span class="math inline">\eta=0.7</span> as the most frequent decision and <span class="math inline">k=1</span> returns <span class="math inline">\eta=0.3</span> as the most frequent decision (which is conservative). Furthermore, we can see that the plot at the top right (<span class="math inline">k=5</span>) presents larger frequency variability than <span class="math inline">k=1</span>. Remember that the target regions are <span class="math inline">\eta \in [0.8, 0.9]</span> for <span class="math inline">\lambda = 0.005</span> or <span class="math inline">\eta \in [0.9]</span> for <span class="math inline">\lambda = 0.05</span>. Therefore, the frequency distribution is more concentrated in the target region if <span class="math inline">k=1</span> for <span class="math inline">\lambda=0.005</span>, and <span class="math inline">k=5</span> for <span class="math inline">\lambda=0.05</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>],</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency1 =</span> sim_surv3<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=1</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency2 =</span> sim_surv3<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=2</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency3 =</span> sim_surv4<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency4 =</span> sim_surv4<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>  <span class="co"># lambda 2</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'eta' is treated as a factor for proper labeling on x-axis</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>eta <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>eta)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with ggplot2</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency1)) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency2)) <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"tomato"</span>) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency3)) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency4)) <span class="sc">+</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"orchid"</span>) <span class="sc">+</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>framed_label <span class="ot">&lt;-</span> <span class="cf">function</span>(text, <span class="at">angle =</span> <span class="dv">0</span>) {</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw_label</span>(</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      text,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> angle,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">0.5</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">size =</span> <span class="fl">0.8</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Label row</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>top_labels <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 1"</span>),</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 5"</span>),</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows with left labels</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.005"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  p1, p2,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.05"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  p3, p4,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine full layout</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  top_labels,</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  row1,</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  row2,</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title: Frequency of eta with the lowest AIC by k and lambda</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_label</span>(<span class="st">"The lowest AIC"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">y =</span> <span class="fl">0.98</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(combined, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.95</span>)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="computo-quarto-extension_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the above figure, we see the results for the AIC. These findings for AIC are very similar to those observed using C-index as the performance criteria. This reinforces that the findings are not due to the criteria chosen but reflect the need to select the number of folds <span class="math inline">k</span> adequate to the problem based on sample size, ratio of events, number of dimensions, number of non-zero features, correlation between the features.</p>
</section>
</section>
<section id="real-application" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Real application</h1>
<section id="real-datasets" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="real-datasets"><span class="header-section-number">4.1</span> Real datasets</h2>
<p>The Whitehall II study is an ongoing prospective cohort study established in 1985-1988 among 10,308 British civil servants aged 35 to 55 years with clinical examinations every four–five years since inception <span class="citation" data-cites="Marmot2005">Marmot and Brunner (<a href="#ref-Marmot2005" role="doc-biblioref">2005</a>)</span>. An accelerometer measure was added to the 2012–2013 wave of data collection, where 4,880 members from the cohort were invited to take part in the sub-study.<br>
Participants were followed for incident NCD up to 2023.</p>
<p>The UK Biobank (UKB) is a prospective population-based cohort study on over 500,000 men and women aged between 40 and 69 years established in 2006-2010 <span class="citation" data-cites="Littlejohns2020">Littlejohns et al. (<a href="#ref-Littlejohns2020" role="doc-biblioref">2020</a>)</span>. The accelerometer sub-study was proposed to 236,519 individuals between 2013-2015 <span class="citation" data-cites="Doherty2017">Doherty et al. (<a href="#ref-Doherty2017" role="doc-biblioref">2017</a>)</span>. Participants were followed for incident NCD up to 2022.</p>
<p>The accelerometer signal from each participant in both cohorts were extracted by <strong>GGIR</strong> R package <span class="citation" data-cites="Migueles2019">Migueles et al. (<a href="#ref-Migueles2019" role="doc-biblioref">2019</a>)</span>. A brief introduction to the 40 accelerometer derived features can be found in <span class="citation" data-cites="Chen2022">Chen et al. (<a href="#ref-Chen2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="Danilevicz2024">Danilevicz, van Hees, et al. (<a href="#ref-Danilevicz2024" role="doc-biblioref">2024</a>)</span>. They represent features related to rest-activity rhythm, daytime activity, sleep, and chronotype.</p>
<p>When there are two datasets, usually the bigger is used as a training set and the smaller as a validation set <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021, 81</a>)</span>. However, we intend to test our hypotheses in separate subpopulations, so we choose Whitehall II (<span class="math inline">n= 3969</span>; 291 incident cases (7.3%)) as a training set in order to validate findings in UKB (<span class="math inline">n=  54833</span>; 750 incident cases (1.4%)) and subgroups of this population. This should not be a problematic because Whitehall II is not a small cohort. Participants were included in the analyses if they had data from at least five valid full day windows (defined as wear times <span class="math inline">\geq2/3</span> of both waking and following sleep periods) <span class="citation" data-cites="Danilevicz2024B">Danilevicz, Vidil, et al. (<a href="#ref-Danilevicz2024B" role="doc-biblioref">2024</a>)</span>.</p>
</section>
<section id="real-data-results" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="real-data-results"><span class="header-section-number">4.2</span> Real data results</h2>
<p>Our first model fit is similar to the simulated one in <a href="#eq-sim" class="quarto-xref">Equation&nbsp;3</a>, but now it has a real interpretation. It is as follows <span class="math display">
h_i(t) = \lambda \exp( Z_i^{(D,\eta)} \beta ),
</span> where <span class="math inline">h_i(t)</span> is the time for the event for the i-th participant, <span class="math inline">Z_i^{(D,\eta)}</span> is a matrix of reduced accelerometer-derived data which depend of our choice of tuning parameters <span class="math inline">D</span> and <span class="math inline">\eta</span>, <span class="math inline">\beta</span> is a <span class="math inline">D</span>-vector of component coefficients.</p>
<div id="fig-cv-plots" class="figure quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cv-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cv-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: C-index plots for <span class="math inline">\eta = 0, 0.05, \dots, 0.95</span> under different seeds, with <span class="math inline">k = 5</span> (left: seed A, right: seed B).
</figcaption>
</figure>
</div>
<p>The <a href="#fig-cv-plots" class="quarto-xref">Figure&nbsp;1</a> shows the iAUC for <span class="math inline">\eta=0, 0.1, \dots, 0.9</span> for <span class="math inline">D=1,\dots,4</span> (components) from 5-fold CV. At the left, the maximum is achieved by <span class="math inline">D=4</span> components at <span class="math inline">\eta=0.7</span> and at the right by <span class="math inline">D=3</span> at <span class="math inline">\eta=0.6</span>. The only difference is the seed to sampling the participants in each fold. This unstable and conflicting results were observed irrespective of the number of folds used for CV, ie, for <span class="math inline">k=3, \dots,10</span> folds.</p>
<p>We move from CV to bootstrap, with the results in the <a href="#fig-boot-plots" class="quarto-xref">Figure&nbsp;2</a> (left). First, we fit the same combinations for CV, ie, <span class="math inline">D=1,\dots,4</span> and <span class="math inline">\eta=0, 0.1, \dots, 0.9</span>. We can see on the left that the results are much more linear, and the number of components is monotomous in terms of four always being higher than three, three always being higher than two, and so on for the respective C-index.</p>
<p>Later, we fit a model that combines the previous model with known risk factors for the event, which is as follow <span class="math display">
h_i(t) = \lambda \exp( Z_i^{(D,\eta)} \beta + X_i \alpha),
</span> where <span class="math inline">X_i</span> is the row-vector of known risk factors (sex, age, ethnicity, education, working status, cohabitation status, smoking, alcohol consumption, daily consumption of fruits and vegetables, body mass index (BMI), hypertension, diabetes, hyperlipidemia, multiple comorbidities, central nervous system (CNS) medication) for the i-th participant, <span class="math inline">\alpha</span> is a <span class="math inline">15</span>-vector of the risk factor coefficient. Then in order to identify the best tuning parameters that allow the selected model to improve the predictive value for NCD as compared to known risk factors, we compared the C-index of the model with only the known risk factors (dotted line in the <a href="#fig-boot-plots" class="quarto-xref">Figure&nbsp;2</a> (right)) with the C-index of models including these risk factors and the fitted accelerometer data for <span class="math inline">\eta=0, 0.05, \dots, 0.95</span> for <span class="math inline">D=1,\dots,4</span>. The C-index mean (points) and CI (bars) were estimated using bootstrap with 1 to 4 components derived from the accelerometer features and all the previously described known risk factors. The C-index for the covariates only was around 0.78. We found that two components are significantly higher than known risk factors only for values of <span class="math inline">\eta</span> in the range <span class="math inline">[0, 0.75]</span>. So the retained model was the one for <span class="math inline">D=2</span> and <span class="math inline">\eta=0.75</span>, allowing to improve C-index while being as sparse as possible.</p>
<div id="fig-boot-plots" class="figure quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boot-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boot-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: C-index (mean and CI) for <span class="math inline">\eta=0, 0.05, \dots, 0.95</span> for <span class="math inline">D=1, \dots, 4</span> components, <span class="math inline">k=1</span>, without (left) and with (right) covariates using Bootstrap with 2000 repetitions (dotted line represents the C-index of sociodemographic, behavioural and health-related covariates only).
</figcaption>
</figure>
</div>
<p>We created a score with <span class="math inline">D=2</span> and <span class="math inline">\eta=0.75</span> for the UKB using the same features and weight matrix <span class="math inline">W^*</span> identified in the Whitehall II cohort. This score significantly improved the predictive value of a model including known risk factors in the external cohort.</p>
<p><strong>Note:</strong> Due to the inclusion of sensitive patient information, the datasets used in this section are not publicly available in order to comply with ethical and data privacy regulations. However, access to the data may be granted upon reasonable request to the respective institutions responsible for their maintenance, as referenced in the data availability disclaimer.</p>
</section>
</section>
<section id="discussion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Discussion</h1>
<p>To evaluate the stability of hyperparameter selection in the context of rare events, we conducted a Monte Carlo simulation comparing one-fold and five-fold cross-validation. The results show that using one fold is more stable than five folds when cases are rare. Specifically, <span class="math inline">\lambda=0.005</span> associated with <span class="math inline">k=5</span> display more conservative decisions (<span class="math inline">\eta&lt;0.5</span>) and larger variability than <span class="math inline">\lambda=0.005</span> associated with <span class="math inline">k=1</span>. In case of rare events, identifying a stable decision of hyper-parameters may be a challenge. Our findings suggest that it may be more reliable to use one fold, opening to two issues: 1) if there is no repetition, we cannot estimate a confidence interval (CI); 2) we cannot validate our findings as there is no remaining data to test. This raises the importance of having an independent datasets as validation sample. The necessity of external validation is a limitation of this approach, as it is not always available.</p>
<p>Our real data application shows that CV is unstable for <span class="math inline">k=5</span> in a large sample size as Whitehall II (<span class="math inline">n= 3969</span>). Changing only the initial seed, CV for <span class="math inline">k=5</span> returns contradictory results such as different optimum values for <span class="math inline">\eta</span> and <span class="math inline">D</span>. The bootstrap result shows a very stable shape for <span class="math inline">\eta</span>. The conclusion was that <span class="math inline">D=2</span> with <span class="math inline">\eta=0.75</span> significantly improved (higher C-index) compared with a model including known risk factors only.</p>
<p>Applied works commonly used 5 folds <span class="citation" data-cites="Chen2022">Chen et al. (<a href="#ref-Chen2022" role="doc-biblioref">2022</a>)</span> or 10 folds <span class="citation" data-cites="Kohavi1995">Kohavi (<a href="#ref-Kohavi1995" role="doc-biblioref">1995</a>)</span>, <span class="citation" data-cites="Lecao2011">Lê Cao, Boitard, and Besse (<a href="#ref-Lecao2011" role="doc-biblioref">2011</a>)</span>. A few studies give general advice for CV for similar machine learning techniques; they can recommend between 2 and 10 folds <span class="citation" data-cites="Breiman1992">Breiman and Spector (<a href="#ref-Breiman1992" role="doc-biblioref">1992</a>)</span> or 3 and 10 folds <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021</a>)</span> [page 82] depending on the sample size. However, they do not consider the ratio of cases by non-cases in dichotomous outcomes. Lê Cao and Welham suggest leave-one-out (LOO) for tiny samples and that Bootstrap might be an interesting new approach <span class="citation" data-cites="Lecao2021">Lê Cao and Welham (<a href="#ref-Lecao2021" role="doc-biblioref">2021, 82</a>)</span>. Our simulation and real application agree that <span class="math inline">k=1</span> is a promising approach for specific situations with few positive outcomes (eg, rare diseases).</p>
<p>Further studies can be developed in several directions. First, this was not an exhaustive simulation study and other parameter may be chosen such as <span class="math inline">n, \lambda, D, \beta, R</span>. Second, other researchers can develop their own simulation to answer their specific goals in terms of sample size, the ratio of events, the number of dimensions, the number of non-zero features, and the correlation between the features (which is simple as this paper displays all the codes for reproducibility). Third, instead of bootstrapping, an alternative and interesting approach is to use U-statistics. <span class="citation" data-cites="Kang2015">Kang et al. (<a href="#ref-Kang2015" role="doc-biblioref">2015</a>)</span> proved that U-statistics can be used to achieve asymptotic distribution of the C-index (confidence intervals may be easily estimated), which saves a lot of time and financial resources if we do cloud processing data.</p>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>The general advice for CV proceedings takes into account the sample size. However, from our study, the number of cases (in dichotomous outcomes) also plays an important role and should not be neglected. Furthermore, dividing the data by folds to CV does not seem a stable strategy if the ratio of cases/noncases is too extreme (which is the case for rare diseases). In fact, a bootstrap on the entire sample appears to be a good solution and we hypothesize that U-statistics could also be useful to derive C-index confidence intervals. However, these approaches require external validation, which is not always available. Further studies can confirm other scenarios where this situation occurs.</p>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Bastien2008" class="csl-entry" role="listitem">
Bastien, P. 2008. <span>“<span class="nocase">Deviance residuals based PLS regression for censored data in high dimensional setting</span>.”</span> <em>Chemometr Intell Lab Syst</em> 91 (1): 78–86. <a href="https://doi.org/10.1016/j.chemolab.2007.09.009">https://doi.org/10.1016/j.chemolab.2007.09.009</a>.
</div>
<div id="ref-Bastien2014" class="csl-entry" role="listitem">
Bastien, P., F. Bertrand, N. Meyer, and Myriam Maumy-Bertrand. 2014. <span>“<span class="nocase">Deviance residuals-based sparse PLS and sparse kernel PLS regression for censored data</span>.”</span> <em>Bioinformatics</em> 31 (3): 397–404. <a href="https://doi.org/10.1093/bioinformatics/btu660">https://doi.org/10.1093/bioinformatics/btu660</a>.
</div>
<div id="ref-Bastien2001" class="csl-entry" role="listitem">
Bastien, P., and M. Tenenhaus. 2001. <span>“<span class="nocase">PLS generalized linear regression. Application to the analysis of life time data.</span>”</span> In <em>Proceedings of the PLS’01 International Symposium Anacapri</em>, 131–40. Italy.
</div>
<div id="ref-Breiman1992" class="csl-entry" role="listitem">
Breiman, L., and P. Spector. 1992. <span>“<span class="nocase">Submodel Selection and Evaluation in Regression</span>.”</span> <em>Int Stat Rev</em> 60 (3): 291–319. <a href="https://doi.org/10.2307/1403680">https://doi.org/10.2307/1403680</a>.
</div>
<div id="ref-Brilleman2021" class="csl-entry" role="listitem">
Brilleman, S. L., R. Wolfe, M. Moreno-Betancur, and Michael J. Crowther. 2021. <span>“Simulating Survival Data Using the Simsurv r Package.”</span> <em>J Stat Soft</em> 97 (3): 1–27. <a href="https://doi.org/10.18637/jss.v097.i03">https://doi.org/10.18637/jss.v097.i03</a>.
</div>
<div id="ref-Cassidy2018" class="csl-entry" role="listitem">
Cassidy, S., H. Fuller, J. Chau, Michael Catt, Adrian Bauman, and Michael I Trenell. 2018. <span>“Accelerometer-Derived Physical Activity in Those with Cardio-Metabolic Disease Compared to Healthy Adults.”</span> <em>Acta Diabetol.</em> 55 (9): 975–79. <a href="https://doi.org/10.1007/s00592-018-1161-8">https://doi.org/10.1007/s00592-018-1161-8</a>.
</div>
<div id="ref-Chan2022" class="csl-entry" role="listitem">
Chan, A., D. Chan, H. Lee, C. C. Ng, and Yeo A. H. L. 2022. <span>“<span class="nocase">Reporting adherence, validity and physical activity measures of wearable activity trackers in medical research: A systematic review</span>.”</span> <em>Int J Med Inform.</em> 160: 104696. <a href="https://doi.org/10.1016/j.ijmedinf.2022.104696">https://doi.org/10.1016/j.ijmedinf.2022.104696</a>.
</div>
<div id="ref-Chen2022" class="csl-entry" role="listitem">
Chen, M., B. Landré, P. Marques-Vidal, Vincent T van Hees, April C E van Gennip, Mikaela Bloomberg, Manasa S Yerramalla, Mohamed Amine Benadjaoud, and Séverine Sabia. 2022. <span>“<span class="nocase">Identification of physical activity and sedentary behaviour dimensions that predict mortality risk in older adults</span>.”</span> <em>EClinicalMedicine</em> 55: 101773. <a href="https://doi.org/10.1016/j.eclinm.2022.101773">https://doi.org/10.1016/j.eclinm.2022.101773</a>.
</div>
<div id="ref-Chun2010" class="csl-entry" role="listitem">
Chun, H., and S. Keles. 2010. <span>“<span class="nocase">Sparse partial least squares regression for simultaneous dimension reduction and variable selection</span>.”</span> <em>J. R. Stat. Soc. B</em> 72: 3–25. <a href="https://doi.org/10.1111/j.1467-9868.2009.00723.x">https://doi.org/10.1111/j.1467-9868.2009.00723.x</a>.
</div>
<div id="ref-Collett1994" class="csl-entry" role="listitem">
Collett, D. 1994. <em>Modelling Survival Data in Medical Research</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/b18041">https://doi.org/10.1201/b18041</a>.
</div>
<div id="ref-Danilevicz2024" class="csl-entry" role="listitem">
Danilevicz, I. M., V. T. van Hees, Frank C. T. van der Heide, Louis Jacob, Benjamin Landré, Mohamed Amine Benadjaoud, and Séverine Sabia. 2024. <span>“<span class="nocase">Measures of fragmentation of rest activity patterns: mathematical properties and interpretability based on accelerometer real life data</span>.”</span> <em>BMC Med. Res. Methodol</em> 24 (1, 132). <a href="https://doi.org/10.1186/s12874-024-02255-w">https://doi.org/10.1186/s12874-024-02255-w</a>.
</div>
<div id="ref-Danilevicz2024B" class="csl-entry" role="listitem">
Danilevicz, I. M., Sam Vidil, Benjamin Landré, Aline Dugravot, Vincent Theodor van Hees, and Séverine Sabia. 2024. <span>“<span class="nocase">Reliable measures of rest-activity rhythm fragmentation: how many days are needed?</span>”</span> <em>Eur Rev Aging Phys Act</em> 21 (29). <a href="https://doi.org/10.1186/s11556-024-00364-5">https://doi.org/10.1186/s11556-024-00364-5</a>.
</div>
<div id="ref-Doherty2017" class="csl-entry" role="listitem">
Doherty, A., D. Jackson, Nils Hammerla, Thomas Plötz, Patrick Olivier, Malcolm H. Granat, Tom White, et al. 2017. <span>“<span class="nocase">Large Scale Population Assessment of Physical Activity Using Wrist Worn Accelerometers</span>.”</span> <em>PloS One</em> 12 (2): e0169649. <a href="https://doi.org/10.1371/journal.pone.0169649">https://doi.org/10.1371/journal.pone.0169649</a>.
</div>
<div id="ref-Jolliffe2003" class="csl-entry" role="listitem">
Jolliffe, I, N. T. Trendafilov, and M. Uddin. 2003. <span>“<span class="nocase">A modified principal component technique based on the LASSO</span>.”</span> <em>J. Comput. Graph. Stat.</em> 12: 531–47. <a href="https://doi.org/10.1198/1061860032148">https://doi.org/10.1198/1061860032148</a>.
</div>
<div id="ref-Kang2015" class="csl-entry" role="listitem">
Kang, L., W. Chen, Nicholas A Petrick, and Brandon D Gallas. 2015. <span>“<span class="nocase">Comparing two correlated C indices with right-censored survival outcome</span>.”</span> <em>Stat Med.</em> 34 (4): 685–703. <a href="https://doi.org/10.1002/sim.6370">https://doi.org/10.1002/sim.6370</a>.
</div>
<div id="ref-Kohavi1995" class="csl-entry" role="listitem">
Kohavi, R. 1995. <span>“<span class="nocase">A study of cross-validation and bootstrap for accuracy estimation and model selection</span>.”</span> In <em>14 Int. Joint Conf. AI</em>, 1137–43. Montreal. <a href="https://doi.org/10.5555/1643031.1643047">https://doi.org/10.5555/1643031.1643047</a>.
</div>
<div id="ref-caret" class="csl-entry" role="listitem">
Kuhn, and Max. 2008. <span>“Building Predictive Models in r Using the Caret Package.”</span> <em>Journal of Statistical Software</em> 28 (5): 1–26. <a href="https://doi.org/10.18637/jss.v028.i05">https://doi.org/10.18637/jss.v028.i05</a>.
</div>
<div id="ref-Lecao2011" class="csl-entry" role="listitem">
Lê Cao, K.-A., S. Boitard, and P. Besse. 2011. <span>“<span class="nocase">Sparse PLS discriminant analysis</span>.”</span> <em>BMC Bioinformatics</em> 12 (253). <a href="https://doi.org/10.1186/1471-2105-12-253">https://doi.org/10.1186/1471-2105-12-253</a>.
</div>
<div id="ref-Lecao2021" class="csl-entry" role="listitem">
Lê Cao, K.-A., and Z. M. Welham. 2021. <em><span>Multivariate Data Integration Using R</span></em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781003026860">https://doi.org/10.1201/9781003026860</a>.
</div>
<div id="ref-Li2006" class="csl-entry" role="listitem">
Li, L. 2006. <span>“<span class="nocase">Survival prediction of diffuse large-B-cell lymphoma based on both clinical and gene expression information</span>.”</span> <em>Bioinformatics</em> 22 (4): 466–71. <a href="https://doi.org/10.1093/bioinformatics/bti824">https://doi.org/10.1093/bioinformatics/bti824</a>.
</div>
<div id="ref-Littlejohns2020" class="csl-entry" role="listitem">
Littlejohns, T. J., J. Holliday, L. M. Gibson, S. Garratt, N. Oesingmann, F. Alfaro-Almagro, and et al. 2020. <span>“<span class="nocase">The UK Biobank imaging enhancement of 100,000 participants</span>.”</span> <em>Nat Commun.</em> 11 (1): 2624. <a href="https://doi.org/10.1038/s41467-020-15948-9">https://doi.org/10.1038/s41467-020-15948-9</a>.
</div>
<div id="ref-Marmot2005" class="csl-entry" role="listitem">
Marmot, M., and E. Brunner. 2005.<span>“<span class="nocase"> Cohort profile: the Whitehall II study</span>.”</span> <em>Int J Epidemiol.</em> 34 (2): 251–56. <a href="https://doi.org/10.1093/ije/dyh372">https://doi.org/10.1093/ije/dyh372</a>.
</div>
<div id="ref-Migueles2019" class="csl-entry" role="listitem">
Migueles, J. H., A. V. Rowlands, F. Huber, Séverine Sabia, and Vincent T. van Hees. 2019. <span>“<span class="nocase">GGIR: a research community–driven open source R package for generating physical activity and sleep outcomes from multi-day raw accelerometer data</span>.”</span> <em>J. Meas. Phys. Behav</em> 2 (3): 188–96. <a href="https://doi.org/10.1123/jmpb.2018-0063">https://doi.org/10.1123/jmpb.2018-0063</a>.
</div>
<div id="ref-Nguyen2023" class="csl-entry" role="listitem">
Nguyen, S., A. Z. LaCroix, K. M. Hayden, C. Di, P. Palta, M. L. Stefanick, J. E. Manson, S. R. Rapp, M. J. LaMonte, and J. &amp; Bellettiere. 2023. <span>“<span class="nocase">Accelerometer-measured physical activity and sitting with incident mild cognitive impairment or probable dementia among older women</span>.”</span> <em>Alzheimer Dement.</em> 19 (7): 3041–54. <a href="https://doi.org/10.1002/alz.12908">https://doi.org/10.1002/alz.12908</a>.
</div>
<div id="ref-Coxmos" class="csl-entry" role="listitem">
Salguero García, Pedro. 2025. <em>Coxmos: Cox MultiBlock Survival</em>. <a href="https://github.com/BiostatOmics/Coxmos">https://github.com/BiostatOmics/Coxmos</a>.
</div>
</div>
</section>
<section id="declarations" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Declarations</h1>
<section id="acknowledges" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="acknowledges"><span class="header-section-number">7.1</span> Acknowledges:</h2>
<p>We thank all of the participating civil service departments and their welfare, personnel, and establishment officers; the British Occupational Health and Safety Agency; the British Council of Civil Service Unions; all participating civil servants in the Whitehall II study; and all members of the Whitehall II study team. The Whitehall II Study team comprises research scientists, statisticians, study coordinators, nurses, data managers, administrative assistants and data entry staff, who make the study possible.</p>
</section>
<section id="funding" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="funding"><span class="header-section-number">7.2</span> Funding:</h2>
<p>The Whitehall II study is and was supported by grants from the National Institute on Aging, NIH (R01AG056477, R01AG062553); UK Medical Research Council (R024227, S011676), and the Wellcome Trust (221854/Z/20/Z). SS is funded by the European Union (ERC grant number 101043884).</p>
<p>The funding agencies had no role in the study design, data collection, analyses, and interpretation of the data or writing of the manuscript. Views and opinions expressed are however those of the authors only and do not necessarily reflect those of the funding agencies. Neither the European Union nor the granting authority can be held responsible for them.</p>
</section>
<section id="data-availability" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="data-availability"><span class="header-section-number">7.3</span> Data availability</h2>
<p>Data cannot be made publicly available because of ethics and Institutional Review Board (IRB) restrictions. However, a data sharing portal allows access to data to undertake analyses within the secure portal in <a href="https://portal.dementiasplatform.uk/">Whitehall II study</a>. The UK Biobank data are available through a procedure described at <a href="https://www.ukbiobank.ac.uk/enable-your-research">UK Biobank data</a>.</p>
</section>
<section id="ethics-approval-and-consent-to-participate" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="ethics-approval-and-consent-to-participate"><span class="header-section-number">7.4</span> Ethics approval and consent to participate:</h2>
<p>Concerning the Whitehall II data, written informed consent for participation was obtained at each contact. Research ethics approval was obtained from the University College London ethics committee (latest reference number 85/0938).</p>
<p>Concerning the UK Biobank data, approval was received from the National Information Governance Board for Health and Social Care and the National Health Service North West Centre for Research Ethics Committee (reference number 11/NW/0382). All participants gave written consent for participation. Our study was conducted using the UKB Resource under application number 96856.</p>
</section>
<section id="authors-contributions" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="authors-contributions"><span class="header-section-number">7.5</span> Authors’ contributions</h2>
<p>IMD and SS developed the hypothesis and study design. IMD conducted data analysis. IMD wrote the first and successive drafts of the manuscript. IMD, SV and SS were involved in the conception, and design of the study, analysis and interpretation of the data, and drafting or critically revising the manuscript for important intellectual content, or, in addition, acquired data. All authors have read and approved the final manuscript.</p>
</section>
<section id="competing-interests" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="competing-interests"><span class="header-section-number">7.6</span> Competing interests:</h2>
<p>The authors declare that they have no competing interests.</p>
</section>
</section>
<section id="finalize-your-submission" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Finalize your submission</h1>
<section id="handle-r-dependencies-with-renv" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="handle-r-dependencies-with-renv"><span class="header-section-number">8.1</span> Handle <code>R</code> dependencies with <code>renv</code></h2>
<p>To make your work reproducible, you need to fix the packages and environment used to run your analysis. For the <code>R</code> system, the <code>renv</code> package is one of the possible reliable method, supported by the community. You basically need a couple of commands to setup your environment on your local machine. First,</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">clean</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>will initialize your repository. Then you just need to install the dependencies required to run your contribution, for instance,</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>) </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"simsurv"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"plsRcox"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"patchwork"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"grid"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"cowplot"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"tidyr"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"caret"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"Coxmos"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Non-CRAN packages (<em>e.g.</em> Github packages) can be used. Once you are done, you can fix everything with the command</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>(<span class="at">type =</span> <span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The only file that needs to be versioned by git is <code>renv.lock</code>. By default, the rest is ignored thanks to <code>.gitignore</code>.</p>
</div>
</div>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="session-information" class="level1 appendix unnumbered"><h2 class="anchored quarto-appendix-heading">Session information</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default
  LAPACK version 3.12.1

locale:
[1] LC_COLLATE=French_France.utf8  LC_CTYPE=French_France.utf8   
[3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C                  
[5] LC_TIME=French_France.utf8    

time zone: Europe/Paris
tzcode source: internal

attached base packages:
[1] grid      stats     graphics  grDevices datasets  utils     methods  
[8] base     

other attached packages:
 [1] cowplot_1.2.0      patchwork_1.3.2    tidyr_1.3.1        dplyr_1.1.4       
 [5] caret_7.0-1        simsurv_1.0.0      Coxmos_1.1.5       plsRcox_1.8.0     
 [9] mixOmics_6.32.0    ggplot2_3.5.2      lattice_0.22-7     MASS_7.3-65       
[13] survcomp_1.58.0    prodlim_2025.04.28 survival_3.8-3    

loaded via a namespace (and not attached):
  [1] splines_4.5.1         polspline_1.1.25      fields_17.1          
  [4] tibble_3.3.0          hardhat_1.4.2         pROC_1.19.0.1        
  [7] rpart_4.1.24          lifecycle_1.0.4       Rdpack_2.6.4         
 [10] rstatix_0.7.2         globals_0.18.0        backports_1.5.0      
 [13] magrittr_2.0.3        Hmisc_5.2-4           rmarkdown_2.29       
 [16] spam_2.11-1           RColorBrewer_1.1-3    lubridate_1.9.4      
 [19] multcomp_1.4-28       maps_3.4.3            abind_1.4-8          
 [22] purrr_1.0.4           rmeta_3.0             nnet_7.3-20          
 [25] TH.data_1.1-4         sandwich_3.1-1        ipred_0.9-15         
 [28] lava_1.8.1            KMsurv_0.1-6          survivalROC_1.0.3.1  
 [31] ggrepel_0.9.6         listenv_0.9.1         ellipse_0.5.0        
 [34] vegan_2.7-1           MatrixModels_0.5-4    RSpectra_0.16-2      
 [37] parallelly_1.45.1     svglite_2.2.1         permute_0.9-8        
 [40] codetools_0.2-20      tidyselect_1.2.1      SuppDists_1.1-9.9    
 [43] shape_1.4.6.1         farver_2.1.2          matrixStats_1.5.0    
 [46] stats4_4.5.1          base64enc_0.1-3       risksetROC_1.0.4.1   
 [49] jsonlite_2.0.0        Formula_1.2-5         iterators_1.0.14     
 [52] systemfonts_1.3.1     foreach_1.5.2         tools_4.5.1          
 [55] progress_1.2.3        sna_2.8               Rcpp_1.0.14          
 [58] glue_1.8.0            rARPACK_0.11-0        gridExtra_2.3        
 [61] xfun_0.52             mgcv_1.9-3            withr_3.0.2          
 [64] fastmap_1.2.0         boot_1.3-31           SparseM_1.84-2       
 [67] digest_0.6.37         timechange_0.3.0      R6_2.6.1             
 [70] textshaping_1.0.3     colorspace_2.1-2      scattermore_1.2      
 [73] generics_0.1.4        pls_2.8-5             renv_1.1.5           
 [76] data.table_1.17.6     recipes_1.3.1         corpcor_1.6.10       
 [79] class_7.3-23          prettyunits_1.2.0     htmlwidgets_1.6.4    
 [82] ModelMetrics_1.2.2.2  pkgconfig_2.0.3       gtable_0.3.6         
 [85] timeDate_4041.110     bipartite_2.23        survMisc_0.5.6       
 [88] furrr_0.3.1           htmltools_0.5.8.1     carData_3.0-5        
 [91] dotCall64_1.2         scales_1.4.0          gower_1.0.2          
 [94] plsRglm_1.6.0         knitr_1.50            km.ci_0.5-6          
 [97] rstudioapi_0.17.1     reshape2_1.4.4        coda_0.19-4.1        
[100] statnet.common_4.12.0 checkmate_2.3.3       nlme_3.1-168         
[103] survAUC_1.4-0         zoo_1.8-14            stringr_1.5.1        
[106] KernSmooth_2.23-26    parallel_4.5.1        foreign_0.8-90       
[109] pillar_1.10.2         vctrs_0.6.5           ggpubr_0.6.1         
[112] car_3.1-3             xtable_1.8-4          cluster_2.1.8.1      
[115] htmlTable_2.4.3       evaluate_1.0.4        mvtnorm_1.3-3        
[118] cli_3.6.5             compiler_4.5.1        rlang_1.1.6          
[121] crayon_1.5.3          rms_8.0-0             future.apply_1.20.0  
[124] ggsignif_0.6.4        labeling_0.4.3        survminer_0.5.1      
[127] plyr_1.8.9            stringi_1.8.7         viridisLite_0.4.2    
[130] network_1.19.0        BiocParallel_1.42.2   glmnet_4.1-10        
[133] quantreg_6.1          Matrix_1.7-3          lars_1.3             
[136] hms_1.1.3             future_1.67.0         kernlab_0.9-33       
[139] rbibutils_2.3         igraph_2.1.4          broom_1.0.10         
[142] bootstrap_2019.6     </code></pre>
</div>
</div>
<!-- -->

</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Accelerometer devices objectively measure the wrist acceleration of human participants @Migueles2019. The derived features calculated from the accelerometer three axial time series aggregated per minute for each participant during a certain period of time can be used to estimate rest-activity rhythm, daytime activity, sleep, and chronotype. These features can be used to predict several health outcomes such as mortality @Chen2022, cardio-metabolic diseases @Cassidy2018, and neurodegenerative diseases @Nguyen2023. This represents a vast potential for medical research @Chan2022 as these devices provide a more objective and detailed information than commonly used self-reported data.</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>In survival analysis, we model the duration from a time origin until an event of interest occurs, considering a set of predictors. In case of several candidate predictors, some selection and/or combination of predictors are often operated to allow for a parsimonious model, using machine learning (ML) methods such as the sparse partial least squares deviance residuals (sPLSDR) model @Bastien2014.</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ML methods often require tuning parameters to be fitted. These parameters are usually pre-estimated using cross-validation (CV) techniques. The general recommendation consists of doing 3 to 10 folds (depending on the sample size) @Lecao2021, within a CV with all combinations of hyper-parameters. The general rule is $n/k&gt;5$, where $n$ is the sample size and $k$ the number of folds @Lecao2021(page 82). The sPLSDR requires two hyper-parameters: First $\eta \in [0,1)$, where 0 means a full dense model with all features, and values close to 1 a highly sparse model with only few features retained; second $D$ components (each component is a combination of features as in PLS regression). One approach consists of determining a large maximum number of components $D$ and a large grid for $\eta$, later trying a finer grid for $\eta$ only on the best options of $D$ @Chen2022. To evaluate the hotspots which are considering the best hyperparameter options must be based on a criterion, eg, integrated AUC survival ROC (iAUC) @Li2006. Even if this approach is commonly used, there are situations when it lacks enough stability.</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>It happens that when the outcome of interest is rare, for example major neurocognitive disorder (NCD), the process of optimisation is unstable for different fold values, and even for the same fold value, it may vary according the initial seed, indicating a lack of reliability. This instability could be due to small sample size where 5 folds for CV are recommended, but we hypothesise that the low proportion of cases by non-cases could be problematic even for large and medium sample size studies.</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>This paper will discuss ways to overcome the challenge of tuning parameter estimation in cases of rare events. Our application is based on the identification of accelerometer data predicting major NCD, such as Alzheimer's disease, using the Whitehall II ($n=3969$) as a training set and the UK Biobank (UKB) as a validation set. Our proposition to get stable results for the tuning parameters is to keep all the data from the training set and bootstrap it, and then to test the validity of the model using in an external dataset (UKB). The optimization process for Whitehall II is unstable for different fold values, and even for the same fold value (with different initial seed), which indicates a lack of reliability. The instability is not due to a small sample size, as Whitehall II is a relatively large cohort. However, the outcome presents a small proportion of incident events (1.4\%, the target disease is the major NCD, which includes Alzheimer’s disease). The problem was not fixed when considering the rules for small sample size (5 folds) which is far from the bottom level $n/k&gt;5$ suggest by @Lecao2021(page 82).</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>A small simulation study was conducted to test the hypotheses of low stability in case of small ratio between cases and non-cases. We artificially created data sets with $n=5000$ where the maximum observation time is 10 years of a disease for which incidence over time is small (resulting in few cases occurring during the observation period). In these simulations, we divided the data into five folds or keep the whole pool together, and we estimated the models using traditional performance criteria, such as the C-index and the Akaike information criterion (AIC).</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Method</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## The sPLS technique</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>The sparse partial least squares regression (sPLS) was proposed by @Chun2010 to promote variable selection during PLS dimension reduction. The sPLS can select variables for the first direction vector and additional variables in the construction of the subsequent direction vectors @Bastien2014.</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>A direct extension of PLS regression to sPLS regression could be provided by imposing $L_1$ constraint on PLS direction on $n$-vector $w$ as $$</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>\max_{w} w^T M w \text{ subject to } w^Tw = ||w||_2 = 1, ||w||_1 \leq c,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>$$ {#eq-spls} where $||w||_2 = w^Tw$, $||w||_1=\sum_{i=1}^{n} |w_i|$, $|u|$ is the absolute of $u$, $M=X^T Y Y^T X$, $Y$ and $X$ are matrices with the same number of rows, $c &gt; 0$ is the $L_1$ constraint. If $Y=X$, then we have the special case sparse principal component analysis (sPCA) @Jolliffe2003.</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Cox proportional hazards model</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>The model assumes the following hazard function for the occurrence of an event at time $t$ in the presence of censoring as follows $h(t) = h_0(t) \exp( \beta^T X),$ where $h_0(t)$ is a baseline hazard function, $\beta$ is a vector of regression coefficients and $X = (X_1,\dots,X_p)$ is a $n \times p$ matrix of features with $x_i = (x_{i1}, \dots, x_{ip})$ a row-vector for the i-th individual. The event could be any disease of interest. Based on the available data, Cox's partial likelihood can be written as $$</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    L(\beta) = \prod_{k \in \Omega} \frac{\exp( \beta^T x_k)}{\sum_{j \in \zeta_k} \exp( \beta^T x_j)},</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>$$ where $\Omega$ is the set of indices of the events and $\zeta_k$ denotes the set of indices of the individuals at risk at time $t_k$. The goal is to find the coefficients which maximize the log partial likelihood function @Bastien2014.</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Deviance residuals</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>Here, we consider a Cox model with no time-dependent explanatory variables and, at most, one event per patient. Regardless, the Martingale residuals for the i-th subject with observation time $t_i$ and event status $\delta_i$, where $\delta_i=0$ if $t_i$ is a censored time, and $\delta_i=1$ otherwise is as $$</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>m_i = \delta_i - \hat{\Delta}_0(t_i) \exp (\hat{\beta}^T x_i),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>$$ where $\hat{\Delta}_0(t_i)$ is the estimated cumulative hazard function at time $t_i$ @Bastien2014. However, the Martingale residuals used to be highly skewed @Bastien2014. Although, the deviance residuals $r_i$ are a normalized transform of the martingale residuals. For the Cox model, the deviance residuals @Collett1994 amount to a form as $$  </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>r_i = \mathrm{sign}  (m_i) <span class="co">[</span><span class="ot">2\{ - r_i - \delta_i \log (\delta_i - m_i)\}</span><span class="co">]</span>^{0.5},</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>$$ {#eq-residuals}</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>where $\mathrm{sign}(u)$ is the sign of $u \in \mathbb{R}$.</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## The sPLSDR model</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>The sparse partial least squares deviance residual (sPLSDR) model was proposed by @Bastien2014 as an upgrade concerning sPLS proposed by @Chun2010 and partial least squares Cox (PLS-Cox) @Bastien2001, @Bastien2008. The general idea is to apply the sPLS technique presented in @eq-spls on the deviance residual from @eq-residuals.</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>The algorithm was described in @Bastien2014 as folllows</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Cox model without covariates to derive the null deviance residuals $r = (r_1, \dots, r_n)^T$ from @eq-residuals.</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Computation of the sPLS components by using the sPLS regression from @eq-spls with the null deviance residuals as outcome.</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Set $\hat{\beta}^{PLS}=0$, $d=1$, $Y=r$.</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>While $d \leq D$:</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>4.1. $w = (|z|-c/2)+ \mathrm{sign}(z)$, where $z=X^TY/|| X^TY||_2$.</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>4.2. Update $\Omega$ as $<span class="sc">\{</span>d : \hat{w}_d \neq 0<span class="sc">\}</span> \cup <span class="sc">\{</span>d : \hat{\beta}^{PLS}_d \neq 0<span class="sc">\}</span>$.</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>4.3. Fit sPLS with $X$ by using the $d$ number of latent components.</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>4.4. Update $\hat{\beta}^{PLS}$ by using the new sPLS estimates of the direction vectors and update $Y$ and $d$ through $Y \leftarrow Y-X\hat{\beta}^{PLS}$ and $d \leftarrow d+1$.</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Cox model on the $D$ retained sPLSDR components.</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="fu"># Monte Carlo study</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation plan</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>We used an exponential survival model, where the hazard function is </span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>h_i(t) = \lambda \exp( X_i \beta ),</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>$${#eq-sim} </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>and the cumulative hazard is $$H_i(t) = \lambda t \exp( X_i \beta ),$$ such as implemented on the **simsurv** R Package by @Brilleman2021. We create artificial data with $n=5000$ number of individuals, $\lambda=0.05, 0.005$ rate parameter, $\beta^T = (\beta^T_1, \beta^T_2, \beta^T_3)$ is the coefficient parameters, composed by $\beta^T_1 = (0.15, 0.1, 0.05)$, $\beta^T_2 = (-0.15, -0.1, -0.05)$ and\</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>$\beta^T_3=(0,0,0,0,0,0)$; the covariate matrix is $X_{i,(1:3)} \sim N(\mu_1, R)$ a multivariate normal with $\mu_1=(0.15, 0.1, 0.05)^T$ and $R$ a matrix with variance on the diagonal of ones and covariance on the off-diagonals of 0.5; $X_{i,(4:6)} \sim N(\mu_2, R)$ a multivariate normal with $\mu_2=(-0.15, -0.1, -0.05)^T$ and same covariance; $X_{i,(7:12)} \sim N(\mu_3, I)$ a multivariate normal with $\mu_3=(0,0,0,0,0,0)^T$ and $I$ an identity matrix. The maximum observed time is $m=10$.</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>So this simple model may be well estimated by a sPLSDR model with two dimensions. We proceed with a Monte Carlo simulation, replicating $M=1000$ times each $\lambda$ and estimating the model changing $\eta=0, 0.1, 0.2, \dots, 0.9$, using $k=1,5$ folds. We save the C-index and the AIC of each iteration of the Monte Carlo. We set all models with two dimensions ($D=2$). Finally, we count how many times each value of $\eta$ was considered the best in the row; this results in a frequency per value of $\eta$.</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation implementation</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>Before the results, we implemented some functions available in the R folder. Also, some packages are necessary, such as **plsRcox** (the original package to estimate sPLSDR @Bastien2014), **Coxmos** (another package to estimate sPLSDR but with a convenient way to extract the $W^*$ matrix of weights, this matrix is similar to a loading matrix in PCA @Coxmos), **caret** (to split the dataset in folds @caret).</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r  message=FALSE, warning=FALSE}</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Set repositories</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>),</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">BioC_mirror =</span> <span class="st">"https://bioconductor.org"</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: install a package only if missing</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>install_if_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg, <span class="at">bioc =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bioc) {</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>, <span class="at">repos =</span> <span class="st">"https://cloud.r-project.org"</span>)</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>      BiocManager<span class="sc">::</span><span class="fu">install</span>(pkg, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(pkg, <span class="at">repos =</span> <span class="st">"https://cloud.r-project.org"</span>)</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages (only if missing)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"mixOmics"</span>, <span class="at">bioc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"survcomp"</span>, <span class="at">bioc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"plsRcox"</span>)</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"Coxmos"</span>)</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"simsurv"</span>)</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"caret"</span>)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survcomp)</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plsRcox)</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Coxmos)</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simsurv)</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Source functions from GitHub</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/iandanilevicz/sPLSDRtuning/main/R/functions3.R"</span>)</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>Then we run the simulations using our loaded functions.</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--this really run --&gt;</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>lambda1 <span class="ot">=</span> <span class="fl">0.005</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>lambda2 <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>nfold <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>maxt <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">1000</span> <span class="co"># replace to 1000</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">=</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>sim_surv1 <span class="ot">=</span>  <span class="fu">sim_surv_c</span>(lambda1, n, M, eta, <span class="at">ncomp=</span><span class="dv">2</span>, <span class="at">nfold=</span>nfold, maxt)   <span class="co"># lambda 1 and c-index</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>sim_surv2 <span class="ot">=</span>  <span class="fu">sim_surv_c</span>(lambda2, n, M, eta, <span class="at">ncomp=</span><span class="dv">2</span>, <span class="at">nfold=</span>nfold, maxt)   <span class="co"># lambda 2 and c-index  </span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>sim_surv3 <span class="ot">=</span>  <span class="fu">sim_surv_aic</span>(lambda1, n, M, eta, <span class="at">ncomp=</span><span class="dv">2</span>, <span class="at">nfold=</span>nfold, maxt) <span class="co"># lambda 1 and AIC  </span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>sim_surv4 <span class="ot">=</span>  <span class="fu">sim_surv_aic</span>(lambda2, n, M, eta, <span class="at">ncomp=</span><span class="dv">2</span>, <span class="at">nfold=</span>nfold, maxt) <span class="co"># lambda 2 and AIC</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation results</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE }</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>eta_vals <span class="ot">&lt;-</span> sim_surv1<span class="sc">$</span>Eta[, <span class="dv">1</span>]</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sim_surv1<span class="sc">$</span>N_features)</span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Long format with lambda as a factor</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eta =</span> <span class="fu">rep</span>(eta_vals, <span class="at">each =</span> n_rep),</span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lambda_0.005 =</span> <span class="fu">as.vector</span>(sim_surv1<span class="sc">$</span>N_features),</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lambda_0.05  =</span> <span class="fu">as.vector</span>(sim_surv2<span class="sc">$</span>N_features)</span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Lambda"</span>), <span class="at">names_to =</span> <span class="st">"Lambda"</span>, <span class="at">values_to =</span> <span class="st">"N_features"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lambda =</span> <span class="fu">recode</span>(Lambda, <span class="at">Lambda_0.005 =</span> <span class="st">"λ = 0.005"</span>, <span class="at">Lambda_0.05 =</span> <span class="st">"λ = 0.05"</span>))</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: grouped boxplots</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Eta), <span class="at">y =</span> N_features, <span class="at">fill =</span> Lambda)) <span class="sc">+</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(eta),</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of selected features"</span>,</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Selected features by eta and lambda"</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"λ = 0.005"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"λ = 0.05"</span> <span class="ot">=</span> <span class="st">"lightgreen"</span>))<span class="sc">+</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">6</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>)</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>The above table shows the results for the number of selected features depending on the value of $\eta$. The number of selected features is decreasing as eta increases. Remember that we set a simulation within the coefficient parameter vector that has a length of 12, but 6 values equal to zero and six different from zero. So, a fair number of selected features must be equal or smaller than six, since there is a moderate correlation between the non-zero coefficients. Finally, the value of eta, which corresponds to a fair number of features, is $\eta \in <span class="co">[</span><span class="ot">0.8, 0.9</span><span class="co">]</span>$ for $\lambda = 0.005$ or $\eta \in <span class="co">[</span><span class="ot">0.9</span><span class="co">]</span>$ for $\lambda = 0.05$. These regions for eta are the targets that we will search for with C-index and AIC in the following figures.</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>],</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency1 =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=1</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency2 =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=2</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency3 =</span> sim_surv2<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 2</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency4 =</span> sim_surv2<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>  <span class="co"># lambda 2</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'eta' is treated as a factor for proper labeling on x-axis</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>eta <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>eta)</span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with ggplot2</span></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency1)) <span class="sc">+</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency2)) <span class="sc">+</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"tomato"</span>) <span class="sc">+</span></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency3)) <span class="sc">+</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency4)) <span class="sc">+</span></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"orchid"</span>) <span class="sc">+</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>framed_label <span class="ot">&lt;-</span> <span class="cf">function</span>(text, <span class="at">angle =</span> <span class="dv">0</span>) {</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw_label</span>(</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>      text,</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> angle,</span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">0.5</span></span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">size =</span> <span class="fl">0.8</span>)</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Label row</span></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>top_labels <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>,</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 1"</span>),</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 5"</span>),</span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows with left labels</span></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.005"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>  p1, p2,</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.05"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>  p3, p4,</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine full layout</span></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>  top_labels,</span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>  row1,</span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>  row2,</span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title: Frequency of eta with the highest C-index by k and lambda</span></span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_label</span>(<span class="st">"The highest C-index"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">y =</span> <span class="fl">0.98</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(combined, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.95</span>)</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>In the above figure, we see the results for the C-index. The figure shows the frequency decision taken by the highest C-index, ie at each simulation, we count the $\eta$, which corresponds to the highest C-index. On top, $\lambda=0.005$, which corresponds to a scenario where there are few incident cases (eg, rare disease), and on the bottom, $\lambda=0.005$ is a scenario with several incident cases (eg, common disease). On the left, the estimation is done by a $k=1$ fold, and on the right, a $k=5$ folds does it. For $\lambda=0.05$ the most frequent decision is $\eta=0.7$ when using $k=5$ which is in line with the general recommendation and with the complexity of the model, but using $k=1$ the most frequent decision is $\eta=0$ (too conservative decision). However, when $\lambda=0.005$ the decision is the reverse: using $k=1$ returns $\eta=0.7$ as the most frequent decision and $k=1$ returns $\eta=0.3$ as the most frequent decision (which is conservative). Furthermore, we can see that the plot at the top right ($k=5$) presents larger frequency variability than $k=1$. Remember that the target regions are $\eta \in <span class="co">[</span><span class="ot">0.8, 0.9</span><span class="co">]</span>$ for $\lambda = 0.005$ or $\eta \in <span class="co">[</span><span class="ot">0.9</span><span class="co">]</span>$ for $\lambda = 0.05$. Therefore, the frequency distribution is more concentrated in the target region if $k=1$ for $\lambda=0.005$, and $k=5$ for $\lambda=0.05$.</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> sim_surv1<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>],</span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency1 =</span> sim_surv3<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=1</span></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency2 =</span> sim_surv3<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 1  k=2</span></span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency3 =</span> sim_surv4<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>, <span class="co"># lambda 2</span></span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency4 =</span> sim_surv4<span class="sc">$</span>Eta[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>]<span class="sc">/</span><span class="dv">10</span>  <span class="co"># lambda 2</span></span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'eta' is treated as a factor for proper labeling on x-axis</span></span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>eta <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>eta)</span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with ggplot2</span></span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency1)) <span class="sc">+</span></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency2)) <span class="sc">+</span></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"tomato"</span>) <span class="sc">+</span></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency3)) <span class="sc">+</span></span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> frequency4)) <span class="sc">+</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"orchid"</span>) <span class="sc">+</span></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a>framed_label <span class="ot">&lt;-</span> <span class="cf">function</span>(text, <span class="at">angle =</span> <span class="dv">0</span>) {</span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw_label</span>(</span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>      text,</span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> angle,</span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">0.5</span></span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">size =</span> <span class="fl">0.8</span>)</span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a><span class="co"># Label row</span></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>top_labels <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>,</span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 1"</span>),</span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="st">"k = 5"</span>),</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows with left labels</span></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.005"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a>  p1, p2,</span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">framed_label</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(lambda ,<span class="st">"= 0.05"</span>)), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a>  p3, p4,</span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine full layout</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>  top_labels,</span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a>  row1,</span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>  row2,</span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title: Frequency of eta with the lowest AIC by k and lambda</span></span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_label</span>(<span class="st">"The lowest AIC"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">y =</span> <span class="fl">0.98</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(combined, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.95</span>)</span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>In the above figure, we see the results for the AIC. These findings for AIC are very similar to those observed using C-index as the performance criteria. This reinforces that the findings are not due to the criteria chosen but reflect the need to select the number of folds $k$ adequate to the problem based on sample size, ratio of events, number of dimensions, number of non-zero features, correlation between the features.</span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a><span class="fu"># Real application</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real datasets</span></span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a>The Whitehall II study is an ongoing prospective cohort study established in 1985-1988 among 10,308 British civil servants aged 35 to 55 years with clinical examinations every four–five years since inception @Marmot2005. An accelerometer measure was added to the 2012–2013 wave of data collection, where 4,880 members from the cohort were invited to take part in the sub-study.\</span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a>Participants were followed for incident NCD up to 2023.</span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a>The UK Biobank (UKB) is a prospective population-based cohort study on over 500,000 men and women aged between 40 and 69 years established in 2006-2010 @Littlejohns2020. The accelerometer sub-study was proposed to 236,519 individuals between 2013-2015 @Doherty2017. Participants were followed for incident NCD up to 2022.</span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>The accelerometer signal from each participant in both cohorts were extracted by **GGIR** R package @Migueles2019. A brief introduction to the 40 accelerometer derived features can be found in @Chen2022 and @Danilevicz2024. They represent features related to rest-activity rhythm, daytime activity, sleep, and chronotype.</span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a>When there are two datasets, usually the bigger is used as a training set and the smaller as a validation set @Lecao2021 <span class="co">[</span><span class="ot">page 81</span><span class="co">]</span>. However, we intend to test our hypotheses in separate subpopulations, so we choose Whitehall II ($n= 3969$; 291 incident cases (7.3%)) as a training set in order to validate findings in UKB ($n=  54833$; 750 incident cases (1.4%)) and subgroups of this population. This should not be a problematic because Whitehall II is not a small cohort. Participants were included in the analyses if they had data from at least five valid full day windows (defined as wear times $\geq2/3$ of both waking and following sleep periods) @Danilevicz2024B.</span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real data results</span></span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a>Our first model fit is similar to the simulated one in @eq-sim, but now it has a real interpretation. It is as follows </span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a>h_i(t) = \lambda \exp( Z_i^{(D,\eta)} \beta ),</span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a>where $h_i(t)$ is the time for the event for the i-th participant, </span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>$Z_i^{(D,\eta)}$ is a matrix of reduced accelerometer-derived data which depend of our choice of tuning parameters $D$ and $\eta$, $\beta$ is a $D$-vector of component coefficients.   </span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>::: {.figure #fig-cv-plots}</span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>\begin{minipage}{0.48\textwidth}</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>\centering</span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>\includegraphics<span class="co">[</span><span class="ot">width=\linewidth</span><span class="co">]</span>{figures/cv1.png}</span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>\caption*{Seed A}</span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>\end{minipage}</span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a>\hfill</span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>\begin{minipage}{0.48\textwidth}</span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a>\centering</span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a>\includegraphics<span class="co">[</span><span class="ot">width=\linewidth</span><span class="co">]</span>{figures/cv2.png}</span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a>\caption*{Seed B}</span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>\end{minipage}</span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a>C-index plots for $\eta = 0, 0.05, \dots, 0.95$ under different seeds, with $k = 5$ (left: seed A, right: seed B).</span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>The @fig-cv-plots shows the iAUC for $\eta=0, 0.1, \dots, 0.9$ for $D=1,\dots,4$ (components) from 5-fold CV. At the left, the maximum is achieved by $D=4$ components at $\eta=0.7$ and at the right by $D=3$ at $\eta=0.6$. The only difference is the seed to sampling the participants in each fold. This unstable and conflicting results were observed irrespective of the number of folds used for CV, ie, for $k=3, \dots,10$ folds.</span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>We move from CV to bootstrap, with the results in the @fig-boot-plots (left). First, we fit the same combinations for CV, ie, $D=1,\dots,4$ and $\eta=0, 0.1, \dots, 0.9$. We can see on the left that the results are much more linear, and the number of components is monotomous in terms of four always being higher than three, three always being higher than two, and so on for the respective C-index.</span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a>Later, we fit a model that combines the previous model with known risk factors for the event, which is as follow </span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>h_i(t) = \lambda \exp( Z_i^{(D,\eta)} \beta + X_i \alpha),</span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>where $X_i$ is the row-vector of known risk factors (sex, age, ethnicity, education, working status, cohabitation status, smoking, alcohol consumption, daily consumption of fruits and vegetables, body mass index (BMI), hypertension, diabetes, hyperlipidemia, multiple comorbidities, central nervous system (CNS) medication) for the i-th participant, $\alpha$ is a $15$-vector of the risk factor coefficient.</span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>Then in order to identify the best tuning parameters that allow the selected model to improve the predictive value for NCD as compared to known risk factors, we compared the C-index of the model with only the known risk factors (dotted line in the @fig-boot-plots (right)) with the C-index of models including these risk factors and the fitted accelerometer data for $\eta=0, 0.05, \dots, 0.95$ for $D=1,\dots,4$. The C-index mean (points) and CI (bars) were estimated using bootstrap with 1 to 4 components derived from the accelerometer features and all the previously described known risk factors. The C-index for the covariates only was around 0.78. We found that two components are significantly higher than known risk factors only for values of $\eta$ in the range $<span class="co">[</span><span class="ot">0, 0.75</span><span class="co">]</span>$. So the retained model was the one for $D=2$ and $\eta=0.75$, allowing to improve C-index while being as sparse as possible.</span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>::: {.figure #fig-boot-plots}</span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a>\begin{minipage}{0.48\textwidth}</span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>\centering</span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>\includegraphics<span class="co">[</span><span class="ot">width=\linewidth</span><span class="co">]</span>{figures/boot1.png}</span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a>\caption*{Without covariates}</span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a>\end{minipage}</span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a>\hfill</span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a>\begin{minipage}{0.48\textwidth}</span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a>\centering</span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a>\includegraphics<span class="co">[</span><span class="ot">width=\linewidth</span><span class="co">]</span>{figures/boot2.png}</span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a>\caption*{With covariates}</span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>\end{minipage}</span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a>C-index (mean and CI) for $\eta=0, 0.05, \dots, 0.95$ for $D=1, \dots, 4$ components, $k=1$, without (left) and with (right) covariates using Bootstrap with 2000 repetitions (dotted line represents the C-index of sociodemographic, behavioural and health-related covariates only).</span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>We created a score with $D=2$ and $\eta=0.75$ for the UKB using the same features and weight matrix $W^*$ identified in the Whitehall II cohort. This score significantly improved the predictive value of a model including known risk factors in the external cohort.</span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a>**Note:** Due to the inclusion of sensitive patient information, the datasets used in this section are not publicly available in order to comply with ethical and data privacy regulations. However, access to the data may be granted upon reasonable request to the respective institutions responsible for their maintenance, as referenced in the data availability disclaimer.</span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a>To evaluate the stability of hyperparameter selection in the context of rare events, we conducted a Monte Carlo simulation comparing one-fold and five-fold cross-validation. The results show that using one fold is more stable than five folds when cases are rare. Specifically, $\lambda=0.005$ associated with $k=5$ display more conservative decisions ($\eta&lt;0.5$) and larger variability than $\lambda=0.005$ associated with $k=1$. In case of rare events, identifying a stable decision of hyper-parameters may be a challenge. Our findings suggest that it may be more reliable to use one fold, opening to two issues: 1) if there is no repetition, we cannot estimate a confidence interval (CI); 2) we cannot validate our findings as there is no remaining data to test. This raises the importance of having an independent datasets as validation sample. The necessity of external validation is a limitation of this approach, as it is not always available.</span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a>Our real data application shows that CV is unstable for $k=5$ in a large sample size as Whitehall II ($n= 3969$). Changing only the initial seed, CV for $k=5$ returns contradictory results such as different optimum values for $\eta$ and $D$. The bootstrap result shows a very stable shape for $\eta$. The conclusion was that $D=2$ with $\eta=0.75$ significantly improved (higher C-index) compared with a model including known risk factors only. </span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a>Applied works commonly used 5 folds @Chen2022 or 10 folds @Kohavi1995, @Lecao2011. A few studies give general advice for CV for similar machine learning techniques; they can recommend between 2 and 10 folds @Breiman1992 or 3 and 10 folds @Lecao2021 <span class="sc">\[</span>page 82<span class="sc">\]</span> depending on the sample size. However, they do not consider the ratio of cases by non-cases in dichotomous outcomes. Lê Cao and Welham suggest leave-one-out (LOO) for tiny samples and that Bootstrap might be an interesting new approach @Lecao2021 <span class="co">[</span><span class="ot">page 82</span><span class="co">]</span>. Our simulation and real application agree that $k=1$ is a promising approach for specific situations with few positive outcomes (eg, rare diseases).</span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a>Further studies can be developed in several directions. First, this was not an exhaustive simulation study and other parameter may be chosen such as $n, \lambda, D, \beta, R$. Second, other researchers can develop their own simulation to answer their specific goals in terms of sample size, the ratio of events, the number of dimensions, the number of non-zero features, and the correlation between the features (which is simple as this paper displays all the codes for reproducibility). Third, instead of bootstrapping, an alternative and interesting approach is to use U-statistics. @Kang2015 proved that U-statistics can be used to achieve asymptotic distribution of the C-index (confidence intervals may be easily estimated), which saves a lot of time and financial resources if we do cloud processing data.</span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a>The general advice for CV proceedings takes into account the sample size. However, from our study, the number of cases (in dichotomous outcomes) also plays an important role and should not be neglected. Furthermore, dividing the data by folds to CV does not seem a stable strategy if the ratio of cases/noncases is too extreme (which is the case for rare diseases). In fact, a bootstrap on the entire sample appears to be a good solution and we hypothesize that U-statistics could also be useful to derive C-index confidence intervals. However, these approaches require external validation, which is not always available. Further studies can confirm other scenarios where this situation occurs.</span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a><span class="fu"># References {.unnumbered}</span></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a><span class="fu"># Declarations</span></span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledges:</span></span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>We thank all of the participating civil service departments and their welfare, personnel, and establishment officers; the British Occupational Health and Safety Agency; the British Council of Civil Service Unions; all participating civil servants in the Whitehall II study; and all members of the Whitehall II study team. The Whitehall II Study team comprises research scientists, statisticians, study coordinators, nurses, data managers, administrative assistants and data entry staff, who make the study possible.</span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a><span class="fu">## Funding:</span></span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a>The Whitehall II study is and was supported by grants from the National Institute on Aging, NIH (R01AG056477, R01AG062553); UK Medical Research Council (R024227, S011676), and the Wellcome Trust (221854/Z/20/Z). SS is funded by the European Union (ERC grant number 101043884).</span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a>The funding agencies had no role in the study design, data collection, analyses, and interpretation of the data or writing of the manuscript. Views and opinions expressed are however those of the authors only and do not necessarily reflect those of the funding agencies. Neither the European Union nor the granting authority can be held responsible for them.</span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data availability</span></span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a>Data cannot be made publicly available because of ethics and Institutional Review Board (IRB) restrictions. However, a data sharing portal allows access to data to undertake analyses within the secure portal in <span class="co">[</span><span class="ot">Whitehall II study</span><span class="co">](https://portal.dementiasplatform.uk/)</span>. The UK Biobank data are available through a procedure described at <span class="co">[</span><span class="ot">UK Biobank data</span><span class="co">](https://www.ukbiobank.ac.uk/enable-your-research)</span>.</span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ethics approval and consent to participate:</span></span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a>Concerning the Whitehall II data, written informed consent for participation was obtained at each contact. Research ethics approval was obtained from the University College London ethics committee (latest reference number 85/0938).</span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a>Concerning the UK Biobank data, approval was received from the National Information Governance Board for Health and Social Care and the National Health Service North West Centre for Research Ethics Committee (reference number 11/NW/0382). All participants gave written consent for participation. Our study was conducted using the UKB Resource under application number 96856.</span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a><span class="fu">## Authors’ contributions</span></span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-493"><a href="#cb10-493" aria-hidden="true" tabindex="-1"></a>IMD and SS developed the hypothesis and study design. IMD conducted data analysis. IMD wrote the first and successive drafts of the manuscript. IMD, SV and SS were involved in the conception, and design of the study, analysis and interpretation of the data, and drafting or critically revising the manuscript for important intellectual content, or, in addition, acquired data. All authors have read and approved the final manuscript.</span>
<span id="cb10-494"><a href="#cb10-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-495"><a href="#cb10-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Competing interests:</span></span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a>The authors declare that they have no competing interests.</span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a><span class="fu"># Finalize your submission</span></span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handle `R` dependencies with `renv`</span></span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a>To make your work reproducible, you need to fix the packages and environment used to run your analysis. For the <span class="in">`R`</span> system, the <span class="in">`renv`</span> package is one of the possible reliable method, supported by the community. You basically need a couple of commands to setup your environment on your local machine. First,</span>
<span id="cb10-504"><a href="#cb10-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-505"><a href="#cb10-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">clean</span>()</span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()</span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a>will initialize your repository. Then you just need to install the dependencies required to run your contribution, for instance,</span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb10-513"><a href="#cb10-513" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>) </span>
<span id="cb10-514"><a href="#cb10-514" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"simsurv"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"plsRcox"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-516"><a href="#cb10-516" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"patchwork"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-517"><a href="#cb10-517" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"grid"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"cowplot"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"tidyr"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"caret"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install.packages</span>(<span class="st">"Coxmos"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a>Non-CRAN packages (*e.g.* Github packages) can be used. Once you are done, you can fix everything with the command</span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>(<span class="at">type =</span> <span class="st">"all"</span>)</span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a>The only file that needs to be versioned by git is <span class="in">`renv.lock`</span>. By default, the rest is ignored thanks to <span class="in">`.gitignore`</span>.</span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information {.appendix .unnumbered}</span></span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session-info}</span></span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb10-540"><a href="#cb10-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.captionPrefix || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  




</body></html>
